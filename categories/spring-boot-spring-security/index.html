<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="robots" content="noindex"><meta name="theme-color" content="#123456"><meta name="generator" content="Hexo 4.2.0"><title>åˆ†ç±»: spring-boot spring-security - ç¥ˆå†¬é›ª</title><link rel="manifest" href="/manifest.json"><meta name="theme-color" content="#3273dc"><meta name="application-name" content="ç¥ˆå†¬é›ª"><meta name="msapplication-TileImage" content="/img/favicon.svg"><meta name="msapplication-TileColor" content="#3273dc"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="ç¥ˆå†¬é›ª"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="ç¥ˆå†¬é›ªå°ç½‘ç«™"><meta property="og:type" content="blog"><meta property="og:title" content="ç¥ˆå†¬é›ª"><meta property="og:url" content="http://example.com/"><meta property="og:site_name" content="ç¥ˆå†¬é›ª"><meta property="og:description" content="ç¥ˆå†¬é›ªå°ç½‘ç«™"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="http://example.com/img/og_image.png"><meta property="article:author" content="ç¥ˆå†¬é›ª"><meta property="twitter:card" content="card"><meta property="twitter:image:src" content="http://example.com/img/og_image.png"><meta property="twitter:site" content="site"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://example.com"},"headline":"ç¥ˆå†¬é›ª","image":["http://example.com/img/og_image.png"],"author":{"@type":"Person","name":"ç¥ˆå†¬é›ª"},"publisher":{"@type":"Organization","name":"ç¥ˆå†¬é›ª","logo":{"@type":"ImageObject","url":"http://example.com/img/logo.svg"}},"description":"ä¸€ä¸ªå°å¾—ä¸èƒ½å†å°çš„å°ç½‘ç«™"}</script><link rel="alternate" href="/path/to/atom.xml" title="ç¥ˆå†¬é›ª" type="application/atom+xml"><link rel="icon" href="/img/favicon.svg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const $tabMenu = document.querySelector(`a[href="${location.hash}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(location.hash);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --></head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/logo.svg" alt="ç¥ˆå†¬é›ª" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">é¦–é¡µ</a><a class="navbar-item" href="/archives">å½’æ¡£</a><a class="navbar-item" href="/categories">åˆ†ç±»</a><a class="navbar-item" href="/tags">æ ‡ç­¾</a><a class="navbar-item" href="/about">å…³äº</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="GitHub" href="https://github.com">GitHub</a><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a><a class="navbar-item search" title="æœç´¢" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-6-widescreen"><div class="card"><div class="card-content"><nav class="breadcrumb" aria-label="breadcrumbs"><ul><li><a href="/categories">åˆ†ç±»</a></li><li class="is-active"><a href="#" aria-current="page">spring-boot spring-security</a></li></ul></nav></div></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2022-08-24T09:01:01.000Z" title="2022/8/24 ä¸‹åˆ5:01:01">2022-08-24</time>å‘è¡¨</span><span class="level-item"><time dateTime="2022-11-21T14:32:53.582Z" title="2022/11/21 ä¸‹åˆ10:32:53">2022-11-21</time>æ›´æ–°</span><span class="level-item"><a class="link-muted" href="/categories/spring-boot-spring-security/">spring-boot spring-security</a></span><span class="level-item">12 åˆ†é’Ÿè¯»å®Œ (å¤§çº¦1744ä¸ªå­—)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2022/08/24/03-security-%E5%8A%A8%E6%80%81%E9%85%8D%E7%BD%AE%E6%9D%83%E9%99%90/">Spring Security åŸºäºæ•°æ®åº“ &amp; åŠ¨æ€é…ç½®æƒé™</a></h1><div class="content"><p>[TOC]</p>
<h2 id="RBACæƒé™è®¾è®¡æ€æƒ³"><a href="#RBACæƒé™è®¾è®¡æ€æƒ³" class="headerlink" title="RBACæƒé™è®¾è®¡æ€æƒ³"></a>RBACæƒé™è®¾è®¡æ€æƒ³</h2><p>ä¸ºäº†è¾¾æˆä¸åŒè´¦å·(å‘˜å·¥ï¼Œç»ç†ï¼ŒBOSS)ç™»å½•ç³»ç»Ÿåèƒ½çœ‹åˆ°ä¸åŒé¡µé¢ï¼Œæ‰§è¡Œä¸åŒçš„åŠŸèƒ½ï¼ŒRBAC(Role-Based-Access-Control)æƒé™æ¨¡å‹ï¼Œå°±æ˜¯æ ¹æ®è§’è‰²çš„æƒé™ï¼Œåˆ†é…å¯è§†é¡µé¢ã€‚</p>
<h3 id="ä¸‰ä¸ªå…³é”®ç‚¹ï¼š"><a href="#ä¸‰ä¸ªå…³é”®ç‚¹ï¼š" class="headerlink" title="ä¸‰ä¸ªå…³é”®ç‚¹ï¼š"></a>ä¸‰ä¸ªå…³é”®ç‚¹ï¼š</h3><p><strong>ç”¨æˆ·</strong>:ä½¿ç”¨ç³»ç»Ÿçš„äºº<br><strong>è§’è‰²</strong>ï¼šä½¿ç”¨ç³»ç»Ÿçš„äººæ˜¯ä»€ä¹ˆèŒä½(å‘˜å·¥ï¼Œç»ç†ï¼ŒBOSS)<br><strong>æƒé™ç‚¹</strong>ï¼šèŒä½å¯ä»¥åšçš„äº‹æƒ…(å·¦ä¾§èœå•æ ä¸­çš„åŠŸèƒ½æ¨¡å—â€”â€”&gt;å¢åˆ æ”¹æŸ¥)</p>
<p><strong>æµ‹è¯•æµç¨‹</strong>ï¼š<br>â‘ åœ¨å‘˜å·¥ç®¡ç†é¡µæ–°å¢å‘˜å·¥è¿™æ˜¯ä¸‰è¦ç´ ä¸­çš„<strong>ç”¨æˆ·</strong><br>â‘¡ä¸ºæ–°å¢çš„å‘˜å·¥<strong>åˆ†é…è§’è‰²</strong><br>â‘¢åœ¨å…¬å¸è®¾ç½®é‡Œä¸ºè§’è‰²<strong>åˆ†é…æƒé™</strong></p>
<p>ğŸ’¢ç³»ç»Ÿä¸­çš„æƒé™ä¸èƒ½éšæ„æ·»åŠ ï¼Œå¿…é¡»æ˜¯ä»¥å¼€å‘å‡ºæ¥çš„æƒé™ï¼ˆå·¦ä¾§èœå•æ é‡Œå¯å®ç°çš„é¡µé¢ï¼‰<br>ğŸ’¢ç”¨æˆ·å’Œè§’è‰²ä¹‹é—´æ˜¯<strong>ä¸€å¯¹å¤š</strong>çš„å…³ç³»ï¼Œä¸€ä¸ªäººèº«å…¼æ•°èŒã€‚</p>
<h3 id="æ•°æ®åº“è®¾è®¡ï¼š"><a href="#æ•°æ®åº“è®¾è®¡ï¼š" class="headerlink" title="æ•°æ®åº“è®¾è®¡ï¼š"></a>æ•°æ®åº“è®¾è®¡ï¼š</h3><p>æœ¬æ¡ˆä¾‹æ•°æ®åº“è®¾è®¡å…±æ¶‰åŠäº”å¼ è¡¨ï¼šuser role user_role menu menu_role</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> Navicat Premium Data Transfer</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> Source Server         : æœ¬åœ°</span></span><br><span class="line"><span class="comment"> Source Server Type    : MySQL</span></span><br><span class="line"><span class="comment"> Source Server Version : 50734</span></span><br><span class="line"><span class="comment"> Source Host           : localhost:3306</span></span><br><span class="line"><span class="comment"> Source Schema         : security</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> Target Server Type    : MySQL</span></span><br><span class="line"><span class="comment"> Target Server Version : 50734</span></span><br><span class="line"><span class="comment"> File Encoding         : 65001</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> Date: 24/08/2022 15:36:45</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SET</span> NAMES utf8mb4;</span><br><span class="line"><span class="keyword">SET</span> FOREIGN_KEY_CHECKS <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Table structure for menu</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> `menu`;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `menu`  (</span><br><span class="line">  `id` <span class="type">int</span>(<span class="number">8</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `<span class="keyword">pattern</span>` <span class="type">varchar</span>(<span class="number">255</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`) <span class="keyword">USING</span> BTREE</span><br><span class="line">) ENGINE <span class="operator">=</span> InnoDB AUTO_INCREMENT <span class="operator">=</span> <span class="number">1</span> <span class="type">CHARACTER</span> <span class="keyword">SET</span> <span class="operator">=</span> utf8 <span class="keyword">COLLATE</span> <span class="operator">=</span> utf8_general_ci ROW_FORMAT <span class="operator">=</span> <span class="keyword">Dynamic</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Records of menu</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Table structure for menu_role</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> `menu_role`;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `menu_role`  (</span><br><span class="line">  `id` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `mid` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `rid` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`) <span class="keyword">USING</span> BTREE</span><br><span class="line">) ENGINE <span class="operator">=</span> InnoDB AUTO_INCREMENT <span class="operator">=</span> <span class="number">4</span> <span class="type">CHARACTER</span> <span class="keyword">SET</span> <span class="operator">=</span> utf8 <span class="keyword">COLLATE</span> <span class="operator">=</span> utf8_general_ci ROW_FORMAT <span class="operator">=</span> <span class="keyword">Dynamic</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Records of menu_role</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `menu_role` <span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `menu_role` <span class="keyword">VALUES</span> (<span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `menu_role` <span class="keyword">VALUES</span> (<span class="number">3</span>, <span class="number">3</span>, <span class="number">3</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Table structure for role</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> `role`;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `role`  (</span><br><span class="line">  `id` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `name` <span class="type">varchar</span>(<span class="number">32</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `nameZh` <span class="type">varchar</span>(<span class="number">32</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`) <span class="keyword">USING</span> BTREE</span><br><span class="line">) ENGINE <span class="operator">=</span> InnoDB AUTO_INCREMENT <span class="operator">=</span> <span class="number">4</span> <span class="type">CHARACTER</span> <span class="keyword">SET</span> <span class="operator">=</span> utf8 <span class="keyword">COLLATE</span> <span class="operator">=</span> utf8_general_ci ROW_FORMAT <span class="operator">=</span> <span class="keyword">Dynamic</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Records of role</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `role` <span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="string">&#x27;ROLE_dba&#x27;</span>, <span class="string">&#x27;æ•°æ®åº“ç®¡ç†å‘˜&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `role` <span class="keyword">VALUES</span> (<span class="number">2</span>, <span class="string">&#x27;ROLE_admin&#x27;</span>, <span class="string">&#x27;ç³»ç»Ÿç®¡ç†å‘˜&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `role` <span class="keyword">VALUES</span> (<span class="number">3</span>, <span class="string">&#x27;ROLE_user&#x27;</span>, <span class="string">&#x27;ç”¨æˆ·&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Table structure for user</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> `<span class="keyword">user</span>`;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `<span class="keyword">user</span>`  (</span><br><span class="line">  `id` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `username` <span class="type">varchar</span>(<span class="number">32</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `password` <span class="type">varchar</span>(<span class="number">255</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `enabled` tinyint(<span class="number">1</span>) <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `locked` tinyint(<span class="number">1</span>) <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`) <span class="keyword">USING</span> BTREE</span><br><span class="line">) ENGINE <span class="operator">=</span> InnoDB AUTO_INCREMENT <span class="operator">=</span> <span class="number">4</span> <span class="type">CHARACTER</span> <span class="keyword">SET</span> <span class="operator">=</span> utf8 <span class="keyword">COLLATE</span> <span class="operator">=</span> utf8_general_ci ROW_FORMAT <span class="operator">=</span> <span class="keyword">Dynamic</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Records of user</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `<span class="keyword">user</span>` <span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="string">&#x27;root&#x27;</span>, <span class="string">&#x27;$2a$10$RMuFXGQ5AtH4wOvkUqyvuecpqUSeoxZYqilXzbz50dceRsga.WYiq&#x27;</span>, <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `<span class="keyword">user</span>` <span class="keyword">VALUES</span> (<span class="number">2</span>, <span class="string">&#x27;admin&#x27;</span>, <span class="string">&#x27;$2a$10$RMuFXGQ5AtH4wOvkUqyvuecpqUSeoxZYqilXzbz50dceRsga.WYiq&#x27;</span>, <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `<span class="keyword">user</span>` <span class="keyword">VALUES</span> (<span class="number">3</span>, <span class="string">&#x27;sang&#x27;</span>, <span class="string">&#x27;$2a$10$RMuFXGQ5AtH4wOvkUqyvuecpqUSeoxZYqilXzbz50dceRsga.WYiq&#x27;</span>, <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Table structure for user_role</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> `user_role`;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `user_role`  (</span><br><span class="line">  `id` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `uid` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `rid` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`) <span class="keyword">USING</span> BTREE</span><br><span class="line">) ENGINE <span class="operator">=</span> InnoDB AUTO_INCREMENT <span class="operator">=</span> <span class="number">5</span> <span class="type">CHARACTER</span> <span class="keyword">SET</span> <span class="operator">=</span> utf8 <span class="keyword">COLLATE</span> <span class="operator">=</span> utf8_general_ci ROW_FORMAT <span class="operator">=</span> <span class="keyword">Dynamic</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Records of user_role</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `user_role` <span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `user_role` <span class="keyword">VALUES</span> (<span class="number">2</span>, <span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `user_role` <span class="keyword">VALUES</span> (<span class="number">3</span>, <span class="number">2</span>, <span class="number">2</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `user_role` <span class="keyword">VALUES</span> (<span class="number">4</span>, <span class="number">3</span>, <span class="number">3</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">SET</span> FOREIGN_KEY_CHECKS <span class="operator">=</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<h2 id="é¡¹ç›®åˆ›å»º"><a href="#é¡¹ç›®åˆ›å»º" class="headerlink" title="é¡¹ç›®åˆ›å»º"></a>é¡¹ç›®åˆ›å»º</h2><h3 id="ä»£ç ä¿®æ”¹"><a href="#ä»£ç ä¿®æ”¹" class="headerlink" title="ä»£ç ä¿®æ”¹"></a>ä»£ç ä¿®æ”¹</h3><p>ç›¸è¾ƒäºä¸Šä¸€ä¸ªé¡¹ç›®æ·»åŠ äº†ä¸€ä¸ªå®ä½“ç±»ç›¸å…³ä»£ç </p>
<p><code>Menu.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@Accessors(chain = true)</span></span><br><span class="line"><span class="meta">@ToString(callSuper = true)</span></span><br><span class="line"><span class="meta">@TableName(value = &quot;menu&quot;,resultMap = &quot;menuWithRolesMap&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Menu</span> &#123;</span><br><span class="line">    <span class="meta">@TableId(type = IdType.AUTO)</span></span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String pattern;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> List&lt;Role&gt; roles;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>MenuMapper</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span><br><span class="line">&lt;!DOCTYPE mapper PUBLIC <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span> &gt;</span><br><span class="line">&lt;mapper namespace=<span class="string">&quot;com.wenx.security.dynamic.mapper.MenuMapper&quot;</span>&gt;</span><br><span class="line">    &lt;resultMap id=<span class="string">&quot;menuWithRolesMap&quot;</span> type=<span class="string">&quot;com.wenx.security.dynamic.bean.Menu&quot;</span>&gt;</span><br><span class="line">        &lt;id column=<span class="string">&quot;id&quot;</span> property=<span class="string">&quot;id&quot;</span>/&gt;</span><br><span class="line">        &lt;result column=<span class="string">&quot;pattern&quot;</span> property=<span class="string">&quot;pattern&quot;</span>/&gt;</span><br><span class="line">        &lt;collection property=<span class="string">&quot;roles&quot;</span> column=<span class="string">&quot;id&quot;</span> select=<span class="string">&quot;com.wenx.security.dynamic.mapper.RoleMapper.selectRolesByMid&quot;</span>/&gt;</span><br><span class="line">    &lt;/resultMap&gt;</span><br><span class="line">&lt;/mapper&gt;</span><br></pre></td></tr></table></figure>

<p><code>ä¿®æ”¹RoleMapper.xml</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.wenx.security.dynamic.mapper.RoleMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectRolesByUid&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.wenx.security.dynamic.bean.Role&quot;</span>&gt;</span></span><br><span class="line">        select r.* from role r,user u,user_role ur where u.id=ur.uid and r.id=ur.rid and u.id = #&#123;uid&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectRolesByMid&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.wenx.security.dynamic.bean.Role&quot;</span>&gt;</span></span><br><span class="line">        select r.* from role r,menu m,menu_role mr where m.id=mr.mid and r.id=mr.rid and m.id = #&#123;mid&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="é‡å†™-FilterInvocationSecurityMetadataSource"><a href="#é‡å†™-FilterInvocationSecurityMetadataSource" class="headerlink" title="é‡å†™ FilterInvocationSecurityMetadataSource"></a>é‡å†™ FilterInvocationSecurityMetadataSource</h3><p><code>MyFiletr.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> æ¸©ç¬™</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyFilter</span> <span class="keyword">implements</span> <span class="title class_">FilterInvocationSecurityMetadataSource</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·¯å¾„è§„åˆ™åŒ¹é…å™¨</span></span><br><span class="line">    <span class="type">AntPathMatcher</span> <span class="variable">antPathMatcher</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AntPathMatcher</span>();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    MenuMapper menuMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Collection&lt;ConfigAttribute&gt; <span class="title function_">getAttributes</span><span class="params">(Object object)</span> <span class="keyword">throws</span> IllegalArgumentException &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">requestUrl</span> <span class="operator">=</span> ((FilterInvocation) object).getRequestUrl();</span><br><span class="line">        List&lt;Menu&gt; menus = menuMapper.selectList(<span class="literal">null</span>);</span><br><span class="line">        <span class="keyword">for</span> (Menu menu : menus) &#123;</span><br><span class="line">            <span class="keyword">if</span>(antPathMatcher.match(menu.getPattern(),requestUrl))&#123;</span><br><span class="line">                List&lt;Role&gt; roles = menu.getRoles();</span><br><span class="line">                String[] rolesStr = <span class="keyword">new</span> <span class="title class_">String</span>[roles.size()];</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; roles.size(); i++) &#123;</span><br><span class="line">                    rolesStr[i]=roles.get(i).getName();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> SecurityConfig.createList(rolesStr);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> SecurityConfig.createList(<span class="string">&quot;ROLE_login&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Collection&lt;ConfigAttribute&gt; <span class="title function_">getAllConfigAttributes</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">supports</span><span class="params">(Class&lt;?&gt; clazz)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ç”¨æˆ·æ‰€æœ‰çš„è¯·æ±‚éƒ½ä¼šè¿›å…¥getAttributesè¿™ä¸ªæ–¹æ³•ä¸­ï¼Œé€šè¿‡è·¯å¾„åŒ¹é…å™¨è¿›è¡ŒåŒ¹é…ï¼Œå°†å¯¹åº”çš„æƒé™å­—ç¬¦ä¸²è¿›è¡Œè¿”å›ï¼Œå¦‚æœåŒ¹é…ä¸åˆ°å°±è¿”å›ä¸€ä¸ª<code>ROLE_login</code>æ ‡å¿—ç¬¦ï¼Œåç»­è¿›è¡Œåˆ¤æ–­æ”¾è¡Œã€‚</p>
</blockquote>
<h3 id="é‡å†™å†³ç­–ç®¡ç†å™¨AccessDecisionManager"><a href="#é‡å†™å†³ç­–ç®¡ç†å™¨AccessDecisionManager" class="headerlink" title="é‡å†™å†³ç­–ç®¡ç†å™¨AccessDecisionManager"></a>é‡å†™å†³ç­–ç®¡ç†å™¨AccessDecisionManager</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyAccessDecisionManager</span> <span class="keyword">implements</span> <span class="title class_">AccessDecisionManager</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">decide</span><span class="params">(Authentication authentication, Object object, Collection&lt;ConfigAttribute&gt; configAttributes)</span> <span class="keyword">throws</span> AccessDeniedException, InsufficientAuthenticationException &#123;</span><br><span class="line">        <span class="keyword">for</span> (ConfigAttribute attribute : configAttributes) &#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="string">&quot;ROLE_login&quot;</span>.equals(attribute.getAttribute()))&#123;</span><br><span class="line">                <span class="keyword">if</span>(authentication <span class="keyword">instanceof</span> AnonymousAuthenticationToken)&#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">AccessDeniedException</span>(<span class="string">&quot;éæ³•è¯·æ±‚&quot;</span>);</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            Collection&lt;? <span class="keyword">extends</span> <span class="title class_">GrantedAuthority</span>&gt; authorities = authentication.getAuthorities();</span><br><span class="line">            <span class="keyword">for</span> (GrantedAuthority authority : authorities) &#123;</span><br><span class="line">                <span class="keyword">if</span>(authority.getAuthority().equals(attribute.getAttribute()))&#123;</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">AccessDeniedException</span>(<span class="string">&quot;éæ³•è¯·æ±‚&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">supports</span><span class="params">(ConfigAttribute attribute)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">supports</span><span class="params">(Class&lt;?&gt; clazz)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="é…ç½®ç±»"><a href="#é…ç½®ç±»" class="headerlink" title="é…ç½®ç±»"></a>é…ç½®ç±»</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableWebSecurity</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SecurityConfig</span> <span class="keyword">extends</span> <span class="title class_">WebSecurityConfigurerAdapter</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    MyFilter myFilter;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    MyAccessDecisionManager myAccessDecisionManager;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    PasswordEncoder <span class="title function_">passwordEncoder</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">BCryptPasswordEncoder</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(AuthenticationManagerBuilder auth)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        auth.userDetailsService(userService);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        http.authorizeRequests()</span><br><span class="line">                .withObjectPostProcessor(<span class="keyword">new</span> <span class="title class_">ObjectPostProcessor</span>&lt;FilterSecurityInterceptor&gt;() &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="keyword">public</span> &lt;O <span class="keyword">extends</span> <span class="title class_">FilterSecurityInterceptor</span>&gt; O <span class="title function_">postProcess</span><span class="params">(O object)</span> &#123;</span><br><span class="line">                        object.setAccessDecisionManager(myAccessDecisionManager);</span><br><span class="line">                        object.setSecurityMetadataSource(myFilter);</span><br><span class="line">                        <span class="keyword">return</span> object;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;)</span><br><span class="line">                .and()</span><br><span class="line">                .formLogin()</span><br><span class="line">                .permitAll()</span><br><span class="line">                .and()</span><br><span class="line">                .csrf().disable();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="æºç åˆ†æ"><a href="#æºç åˆ†æ" class="headerlink" title="æºç åˆ†æ"></a>æºç åˆ†æ</h2><p>é¦–å…ˆåœ¨ Spring Security ä¸­çš„æƒé™æ§åˆ¶æœ‰ä¸¤ç§ä¸åŒçš„æ–¹å¼ï¼š</p>
<ol>
<li>é€šè¿‡ URL è¯·æ±‚åœ°å€è¿›è¡Œæ§åˆ¶ã€‚</li>
<li>é€šè¿‡æ–¹æ³•è¿›è¡Œæ§åˆ¶ã€‚</li>
</ol>
<p>å¦‚æœé€šè¿‡ URL è¯·æ±‚åœ°å€è¿›è¡Œæ§åˆ¶ï¼Œè´Ÿè´£æ§åˆ¶ç±»é…ç½®çš„æ˜¯ AbstractInterceptUrlConfigurerï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹å®ƒçš„å­ç±»ï¼š</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># AbstractInterceptUrlConfigurer</span></span><br><span class="line"><span class="section">## UrlAuthorizationConfigurer</span></span><br><span class="line"><span class="section">## ExpressionUrlAuthorizationConfigurer</span></span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°å®ƒæœ‰ä¸¤ä¸ªå­ç±»ï¼š</p>
<ul>
<li>ExpressionUrlAuthorizationConfigurer</li>
<li>UrlAuthorizationConfigurer</li>
</ul>
<p>ä¸¤ä¸ªéƒ½å¯ä»¥å¤„ç†åŸºäº URL è¯·æ±‚åœ°å€çš„æƒé™æ§åˆ¶ã€‚ä¸åŒçš„æ˜¯ï¼Œç¬¬ä¸€ä¸ª ExpressionUrlAuthorizationConfigurer<br>æ”¯æŒæƒé™è¡¨è¾¾å¼ï¼Œç¬¬äºŒä¸ªä¸æ”¯æŒã€‚</p>
<p>UrlAuthorizationConfigurer ä¸æ”¯æŒæƒé™è¡¨è¾¾å¼ï¼Œæ˜¯å› ä¸ºå®ƒä½¿ç”¨çš„æŠ•ç¥¨å™¨æ˜¯ RoleVoter å’Œ AuthenticatedVoterï¼Œè¿™ä¸¤è€…å¯ä»¥ç”¨æ¥å¤„ç†è§’è‰²æˆ–è€…æƒé™ï¼Œä½†æ˜¯æ²¡æ³•å¤„ç†æƒé™è¡¨è¾¾å¼ã€‚</p>
<p>ä¸Šé¢è¯´çš„éƒ½æ˜¯é»˜è®¤è¡Œä¸ºï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ä¿®æ”¹é…ç½®ï¼Œè®© UrlAuthorizationConfigurer æ”¯æŒæƒé™è¡¨è¾¾å¼ï¼Œä¸è¿‡ä¸€èˆ¬æ¥è¯´æ²¡å¿…è¦è¿™æ ·åšï¼Œå¦‚æœéœ€è¦æ”¯æŒæƒé™è¡¨è¾¾å¼ï¼Œç›´æ¥ç”¨ ExpressionUrlAuthorizationConfigurer å³å¯ã€‚</p>
<p>å½“æˆ‘ä»¬è°ƒç”¨å¦‚ä¸‹è¿™è¡Œä»£ç æ—¶ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http.authorizeRequests()</span><br></pre></td></tr></table></figure>

<p>å®é™…ä¸Šå°±æ˜¯é€šè¿‡ ExpressionUrlAuthorizationConfigurer å»é…ç½®åŸºäº URL è¯·æ±‚åœ°å€çš„æƒé™æ§åˆ¶ï¼Œæ‰€ä»¥å®ƒæ˜¯æ”¯æŒæƒé™è¡¨è¾¾å¼çš„ã€‚ä¾‹å¦‚ä¸‹é¢è¿™æ®µå¤§å®¶å†ç†Ÿæ‚‰ä¸è¿‡çš„ä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">http.authorizeRequests()</span><br><span class="line">        .antMatchers(<span class="string">&quot;/admin/**&quot;</span>).hasRole(<span class="string">&quot;ADMIN&quot;</span>)</span><br><span class="line">        .antMatchers(<span class="string">&quot;/user/**&quot;</span>).access(<span class="string">&quot;hasRole(&#x27;USER&#x27;)&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>åœ¨ ExpressionUrlAuthorizationConfigurer ä¸­åˆ›å»º SecurityMetadataSource æ—¶ï¼Œå°±ä¼šæ£€æŸ¥æ˜ å°„å…³ç³»ï¼Œå¦‚æœ requestMap ä¸ºç©ºå°±ä¼šæŠ›å‡ºå¼‚å¸¸ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">ExpressionBasedFilterInvocationSecurityMetadataSource <span class="title function_">createMetadataSource</span><span class="params">(</span></span><br><span class="line"><span class="params">		H http)</span> &#123;</span><br><span class="line">	LinkedHashMap&lt;RequestMatcher, Collection&lt;ConfigAttribute&gt;&gt; requestMap = REGISTRY</span><br><span class="line">			.createRequestMap();</span><br><span class="line">	<span class="keyword">if</span> (requestMap.isEmpty()) &#123;</span><br><span class="line">		<span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(</span><br><span class="line">				<span class="string">&quot;At least one mapping is required (i.e. authorizeRequests().anyRequest().authenticated())&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ExpressionBasedFilterInvocationSecurityMetadataSource</span>(requestMap,</span><br><span class="line">			getExpressionHandler(http));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>UrlAuthorizationConfigurer ä¸­ä¹Ÿæœ‰ createMetadataSource æ–¹æ³•ï¼Œä½†æ˜¯å´æ˜¯å¦å¤–ä¸€å¥—å®ç°æ–¹æ¡ˆï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">FilterInvocationSecurityMetadataSource <span class="title function_">createMetadataSource</span><span class="params">(H http)</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DefaultFilterInvocationSecurityMetadataSource</span>(</span><br><span class="line">			REGISTRY.createRequestMap());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>UrlAuthorizationConfigurer å¹¶ä¸ä¼šæ£€æŸ¥ requestMap æ˜¯å¦ä¸ºç©ºï¼Œä½†æ˜¯å®ƒä¼šåœ¨ createRequestMap æ–¹æ³•ä¸­æ£€æŸ¥ä¸€ä¸‹æ˜ å°„å…³ç³»æ˜¯å¦å®Œæ•´ï¼Œä¾‹å¦‚ä¸‹é¢è¿™æ ·ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.antMatchers(<span class="string">&quot;/admin/**&quot;</span>).access(<span class="string">&quot;ROLE_ADMIN&quot;</span>)</span><br><span class="line">.mvcMatchers(<span class="string">&quot;/user/**&quot;</span>).access(<span class="string">&quot;ROLE_USER&quot;</span>)</span><br><span class="line">.antMatchers(<span class="string">&quot;/getinfo&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>æœ€åçš„ &#x2F;getinfo æ²¡æœ‰æŒ‡å®šéœ€è¦çš„æƒé™ï¼Œè¿™ç§å°±æ˜¯ä¸å®Œæ•´ï¼Œå°±ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚</p>
<p>ExpressionUrlAuthorizationConfigurer ä¼šè¦æ±‚è‡³å°‘é…ç½®ä¸€ä¸ªæ˜ å°„å…³ç³»ï¼ŒUrlAuthorizationConfigurer åˆ™æ— æ­¤è¦æ±‚ã€‚</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2022-08-24T03:05:01.000Z" title="2022/8/24 ä¸Šåˆ11:05:01">2022-08-24</time>å‘è¡¨</span><span class="level-item"><time dateTime="2022-11-21T14:32:53.582Z" title="2022/11/21 ä¸‹åˆ10:32:53">2022-11-21</time>æ›´æ–°</span><span class="level-item"><a class="link-muted" href="/categories/spring-boot-spring-security/">spring-boot spring-security</a></span><span class="level-item">13 åˆ†é’Ÿè¯»å®Œ (å¤§çº¦1910ä¸ªå­—)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2022/08/24/02-security%E5%9F%BA%E4%BA%8E%E6%95%B0%E6%8D%AE%E5%BA%93/">Spring Security åŸºäºæ•°æ®åº“ &amp; è§’è‰²ç»§æ‰¿</a></h1><div class="content"><h2 id="æˆæƒ"><a href="#æˆæƒ" class="headerlink" title="æˆæƒ"></a>æˆæƒ</h2><p>æ‰€è°“çš„æˆæƒï¼Œå°±æ˜¯ç”¨æˆ·å¦‚æœè¦è®¿é—®æŸä¸€ä¸ªèµ„æºï¼Œæˆ‘ä»¬è¦å»æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å…·å¤‡è¿™æ ·çš„æƒé™ï¼Œå¦‚æœå…·å¤‡å°±å…è®¸è®¿é—®ï¼Œå¦‚æœä¸å…·å¤‡ï¼Œåˆ™ä¸å…è®¸è®¿é—®ã€‚</p>
<h3 id="å‡†å¤‡æ•°æ®åº“è„šæœ¬"><a href="#å‡†å¤‡æ•°æ®åº“è„šæœ¬" class="headerlink" title="å‡†å¤‡æ•°æ®åº“è„šæœ¬"></a>å‡†å¤‡æ•°æ®åº“è„šæœ¬</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">Navicat MySQL Data Transfer</span></span><br><span class="line"><span class="comment">Source Server         : localhost</span></span><br><span class="line"><span class="comment">Source Server Version : 50717</span></span><br><span class="line"><span class="comment">Source Host           : localhost:3306</span></span><br><span class="line"><span class="comment">Source Database       : security</span></span><br><span class="line"><span class="comment">Target Server Type    : MYSQL</span></span><br><span class="line"><span class="comment">Target Server Version : 50717</span></span><br><span class="line"><span class="comment">File Encoding         : 65001</span></span><br><span class="line"><span class="comment">Date: 2018-07-28 15:26:51</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SET</span> FOREIGN_KEY_CHECKS<span class="operator">=</span><span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Table structure for role</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> `role`;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `role` (</span><br><span class="line">  `id` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `name` <span class="type">varchar</span>(<span class="number">32</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `nameZh` <span class="type">varchar</span>(<span class="number">32</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB AUTO_INCREMENT<span class="operator">=</span><span class="number">4</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Records of role</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `role` <span class="keyword">VALUES</span> (<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;dba&#x27;</span>, <span class="string">&#x27;æ•°æ®åº“ç®¡ç†å‘˜&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `role` <span class="keyword">VALUES</span> (<span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;admin&#x27;</span>, <span class="string">&#x27;ç³»ç»Ÿç®¡ç†å‘˜&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `role` <span class="keyword">VALUES</span> (<span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;user&#x27;</span>, <span class="string">&#x27;ç”¨æˆ·&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Table structure for user</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> `<span class="keyword">user</span>`;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `<span class="keyword">user</span>` (</span><br><span class="line">  `id` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `username` <span class="type">varchar</span>(<span class="number">32</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `password` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `enabled` tinyint(<span class="number">1</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `locked` tinyint(<span class="number">1</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB AUTO_INCREMENT<span class="operator">=</span><span class="number">4</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Records of user</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `<span class="keyword">user</span>` <span class="keyword">VALUES</span> (<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;root&#x27;</span>, <span class="string">&#x27;$2a$10$RMuFXGQ5AtH4wOvkUqyvuecpqUSeoxZYqilXzbz50dceRsga.WYiq&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;0&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `<span class="keyword">user</span>` <span class="keyword">VALUES</span> (<span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;admin&#x27;</span>, <span class="string">&#x27;$2a$10$RMuFXGQ5AtH4wOvkUqyvuecpqUSeoxZYqilXzbz50dceRsga.WYiq&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;0&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `<span class="keyword">user</span>` <span class="keyword">VALUES</span> (<span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;sang&#x27;</span>, <span class="string">&#x27;$2a$10$RMuFXGQ5AtH4wOvkUqyvuecpqUSeoxZYqilXzbz50dceRsga.WYiq&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;0&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Table structure for user_role</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> `user_role`;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `user_role` (</span><br><span class="line">  `id` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `uid` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `rid` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB AUTO_INCREMENT<span class="operator">=</span><span class="number">5</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Records of user_role</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `user_role` <span class="keyword">VALUES</span> (<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;1&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `user_role` <span class="keyword">VALUES</span> (<span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;2&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `user_role` <span class="keyword">VALUES</span> (<span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;2&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `user_role` <span class="keyword">VALUES</span> (<span class="string">&#x27;4&#x27;</span>, <span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;3&#x27;</span>);</span><br><span class="line"><span class="keyword">SET</span> FOREIGN_KEY_CHECKS<span class="operator">=</span><span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<h3 id="å®ä½“ç±»"><a href="#å®ä½“ç±»" class="headerlink" title="å®ä½“ç±»"></a>å®ä½“ç±»</h3><ol>
<li><p>User ç±» å®ç° UserDetail æ¥å£ä¸­çš„æ–¹æ³•</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@Accessors(chain = true)</span></span><br><span class="line"><span class="meta">@ToString(callSuper = true)</span></span><br><span class="line"><span class="meta">@TableName(value = &quot;user&quot;,resultMap = &quot;userWithRolesMap&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> <span class="keyword">implements</span> <span class="title class_">UserDetails</span> &#123;</span><br><span class="line">    <span class="meta">@TableId(type = IdType.AUTO)</span></span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="keyword">private</span> Boolean enabled;</span><br><span class="line">    <span class="keyword">private</span> Boolean locked;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> List&lt;Role&gt; roles;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Collection&lt;? <span class="keyword">extends</span> <span class="title class_">GrantedAuthority</span>&gt; getAuthorities() &#123;</span><br><span class="line">        List&lt;SimpleGrantedAuthority&gt; authorities = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        roles.forEach(r-&gt;&#123;</span><br><span class="line">            authorities.add(<span class="keyword">new</span> <span class="title class_">SimpleGrantedAuthority</span>(<span class="string">&quot;ROLE_&quot;</span>+r.getName()));</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">return</span> authorities;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isAccountNonExpired</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isAccountNonLocked</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> !locked;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isCredentialsNonExpired</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isEnabled</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> enabled;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Role ç±»</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@TableName(&quot;role&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Role</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String nameZh;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>UserService ç±»å®ç° UserDetailService ç±»</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserService</span> , UserDetailsService &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    UserMapper userMapper;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®ç”¨æˆ·åæŸ¥è¯¢ç”¨æˆ·</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> username the username identifying the user whose data is required.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> UserDetails</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> UsernameNotFoundException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> UserDetails <span class="title function_">loadUserByUsername</span><span class="params">(String username)</span> <span class="keyword">throws</span> UsernameNotFoundException &#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userMapper.selectOne(</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;User&gt;().eq(User::getUsername, username)</span><br><span class="line">        );</span><br><span class="line">        <span class="keyword">if</span>(user==<span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UsernameNotFoundException</span>(<span class="string">&quot;ç”¨æˆ·ä¸å­˜åœ¨&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>UserMapper æ¥å£</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> <span class="keyword">extends</span> <span class="title class_">BaseMapper</span>&lt;User&gt; &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>UserMapper.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.wenx.security.security.mapper.UserMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;userWithRolesMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;com.wenx.security.security.bean.User&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;username&quot;</span> <span class="attr">property</span>=<span class="string">&quot;username&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;password&quot;</span> <span class="attr">property</span>=<span class="string">&quot;password&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;enabled&quot;</span> <span class="attr">property</span>=<span class="string">&quot;enabled&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;locked&quot;</span> <span class="attr">property</span>=<span class="string">&quot;locked&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;roles&quot;</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">select</span>=<span class="string">&quot;com.wenx.security.security.mapper.RoleMapper.selectRolesByUid&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>RoleMapper.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.wenx.security.security.mapper.RoleMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectRolesByUid&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.wenx.security.security.bean.Role&quot;</span>&gt;</span></span><br><span class="line">        select r.* from role r,user u,user_role ur where u.id=ur.uid and r.id=ur.rid and u.id = #&#123;uid&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="é…ç½®ç±»"><a href="#é…ç½®ç±»" class="headerlink" title="é…ç½®ç±»"></a>é…ç½®ç±»</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wenx.security.security.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.wenx.security.security.service.UserService;</span><br><span class="line"><span class="keyword">import</span> com.wenx.security.security.service.impl.UserServiceImpl;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.config.annotation.web.builders.HttpSecurity;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.userdetails.UserDetails;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.crypto.password.PasswordEncoder;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"></span><br><span class="line"><span class="meta">@EnableWebSecurity</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SecurityConfig</span> <span class="keyword">extends</span> <span class="title class_">WebSecurityConfigurerAdapter</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    UserServiceImpl userService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(AuthenticationManagerBuilder auth)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        auth.userDetailsService(userService);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    PasswordEncoder <span class="title function_">passwordEncoder</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">BCryptPasswordEncoder</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        http.authorizeRequests()</span><br><span class="line">                .antMatchers(<span class="string">&quot;/dba/**&quot;</span>).hasRole(<span class="string">&quot;dba&quot;</span>)</span><br><span class="line">                .antMatchers(<span class="string">&quot;/user/**&quot;</span>).hasRole(<span class="string">&quot;user&quot;</span>)</span><br><span class="line">                .antMatchers(<span class="string">&quot;/admin/**&quot;</span>).hasRole(<span class="string">&quot;admin&quot;</span>)</span><br><span class="line">                .anyRequest().authenticated()</span><br><span class="line">                .and()</span><br><span class="line">                .formLogin()</span><br><span class="line">                .permitAll()</span><br><span class="line">                .and()</span><br><span class="line">                .csrf().disable();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="å‡†å¤‡æ¥å£"><a href="#å‡†å¤‡æ¥å£" class="headerlink" title="å‡†å¤‡æ¥å£"></a>å‡†å¤‡æ¥å£</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/hello&quot;)</span></span><br><span class="line">String <span class="title function_">hello</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@GetMapping(&quot;/dba/hello&quot;)</span></span><br><span class="line">String <span class="title function_">dbaHello</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;DBA hello&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@GetMapping(&quot;/admin/hello&quot;)</span></span><br><span class="line">String <span class="title function_">adminHello</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;admin hello&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@GetMapping(&quot;/user/hello&quot;)</span></span><br><span class="line">String <span class="title function_">userHello</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;user hello&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>å½“æˆ‘ä»¬ä½¿ç”¨ root ç”¨æˆ·è¿›è¡Œç™»å½•ï¼Œ<code>/dba/hello</code> <code>/admin/hello</code>æ˜¯å¯ä»¥è¿›è¡Œè®¿é—®çš„ <code>/user/hello</code>æ²¡æœ‰æƒé™è®¿é—®</p>
<h2 id="è§’è‰²ç»§æ‰¿"><a href="#è§’è‰²ç»§æ‰¿" class="headerlink" title="è§’è‰²ç»§æ‰¿"></a>è§’è‰²ç»§æ‰¿</h2><p>è§’è‰²ç»§æ‰¿å®é™…ä¸Šæ˜¯ä¸€ä¸ªå¾ˆå¸¸è§çš„éœ€æ±‚ï¼Œå› ä¸ºå¤§éƒ¨åˆ†å…¬å¸æ²»ç†å¯èƒ½éƒ½æ˜¯é‡‘å­—å¡”å½¢çš„ï¼Œä¸Šå¸å¯èƒ½å…·å¤‡ä¸‹å±çš„éƒ¨åˆ†ç”šè‡³æ‰€æœ‰æƒé™ï¼Œè¿™ä¸€ç°å®åœºæ™¯ï¼Œåæ˜ åˆ°æˆ‘ä»¬çš„ä»£ç ä¸­ï¼Œå°±æ˜¯è§’è‰²ç»§æ‰¿äº†ã€‚ Spring Security ä¸­ä¸ºå¼€å‘è€…æä¾›äº†ç›¸å…³çš„è§’è‰²ç»§æ‰¿è§£å†³æ–¹æ¡ˆï¼Œä½†æ˜¯è¿™ä¸€è§£å†³æ–¹æ¡ˆåœ¨æœ€è¿‘çš„ Spring Security ç‰ˆæœ¬å˜è¿ä¸­ï¼Œä½¿ç”¨æ–¹æ³•æœ‰æ‰€å˜åŒ–ã€‚</p>
<p>pringSecurity åœ¨è§’è‰²ç»§æ‰¿ä¸Šæœ‰ä¸¤ç§ä¸åŒçš„å†™æ³•ï¼Œåœ¨ Spring Boot2.0.8ï¼ˆå¯¹åº” Spring Security ä¹Ÿæ˜¯ 5.0.11ï¼‰ä¸Šé¢æ˜¯ä¸€ç§å†™æ³•ï¼Œä» Spring Boot2.1.0ï¼ˆå¯¹åº” Spring Security5.1.1ï¼‰åˆæ˜¯å¦å¤–ä¸€ç§å†™æ³•</p>
<h3 id="ä»¥å‰çš„å†™æ³•"><a href="#ä»¥å‰çš„å†™æ³•" class="headerlink" title="ä»¥å‰çš„å†™æ³•"></a>ä»¥å‰çš„å†™æ³•</h3><p>è¿™é‡Œè¯´çš„ä»¥å‰å†™æ³•ï¼Œå°±æ˜¯æŒ‡ SpringBoot2.0.8ï¼ˆå«ï¼‰ä¹‹å‰çš„å†™æ³•ï¼Œåœ¨ä¹‹å‰çš„å†™æ³•ä¸­ï¼Œè§’è‰²ç»§æ‰¿åªéœ€è¦å¼€å‘è€…æä¾›ä¸€ä¸ª RoleHierarchy æ¥å£çš„å®ä¾‹å³å¯ï¼Œä¾‹å¦‚ä¸‹é¢è¿™æ ·ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line">RoleHierarchy <span class="title function_">roleHierarchy</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">RoleHierarchyImpl</span> <span class="variable">roleHierarchy</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RoleHierarchyImpl</span>();</span><br><span class="line">    <span class="type">String</span> <span class="variable">hierarchy</span> <span class="operator">=</span> <span class="string">&quot;ROLE_dba &gt; ROLE_admin ROLE_admin &gt; ROLE_user&quot;</span>;</span><br><span class="line">    roleHierarchy.setHierarchy(hierarchy);</span><br><span class="line">    <span class="keyword">return</span> roleHierarchy;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™é‡Œæˆ‘ä»¬æä¾›äº†ä¸€ä¸ª RoleHierarchy æ¥å£çš„å®ä¾‹ï¼Œä½¿ç”¨å­—ç¬¦ä¸²æ¥æè¿°äº†è§’è‰²ä¹‹é—´çš„ç»§æ‰¿å…³ç³»ï¼Œ <code>ROLE_dba</code> å…·å¤‡ <code>ROLE_admin</code> çš„æ‰€æœ‰æƒé™ï¼Œè€Œ <code>ROLE_admin</code> åˆ™å…·å¤‡ <code>ROLE_user</code> çš„æ‰€æœ‰æƒé™ï¼Œç»§æ‰¿ä¸ç»§æ‰¿ä¹‹é—´ç”¨ä¸€ä¸ªç©ºæ ¼éš”å¼€ã€‚æä¾›äº†è¿™ä¸ª Bean ä¹‹åï¼Œä»¥åæ‰€æœ‰å…·å¤‡ <code>ROLE_user</code> è§’è‰²æ‰èƒ½è®¿é—®çš„èµ„æºï¼Œ <code>ROLE_dba</code> å’Œ <code>ROLE_admin</code> ä¹Ÿéƒ½èƒ½è®¿é—®ï¼Œå…·å¤‡ <code>ROLE_amdin</code> è§’è‰²æ‰èƒ½è®¿é—®çš„èµ„æºï¼Œ <code>ROLE_dba</code> ä¹Ÿèƒ½è®¿é—®ã€‚</p>
<h3 id="ç°åœ¨çš„å†™æ³•"><a href="#ç°åœ¨çš„å†™æ³•" class="headerlink" title="ç°åœ¨çš„å†™æ³•"></a>ç°åœ¨çš„å†™æ³•</h3><p>ä½†æ˜¯ä¸Šé¢è¿™ç§å†™æ³•ä»…é™äº Spring Boot2.0.8ï¼ˆå«ï¼‰ä¹‹å‰çš„ç‰ˆæœ¬ï¼Œåœ¨ä¹‹åçš„ç‰ˆæœ¬ä¸­ï¼Œè¿™ç§å†™æ³•åˆ™ä¸è¢«æ”¯æŒï¼Œæ–°ç‰ˆçš„å†™æ³•æ˜¯ä¸‹é¢è¿™æ ·ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line">RoleHierarchy <span class="title function_">roleHierarchy</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">RoleHierarchyImpl</span> <span class="variable">roleHierarchy</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RoleHierarchyImpl</span>();</span><br><span class="line">    <span class="type">String</span> <span class="variable">hierarchy</span> <span class="operator">=</span> <span class="string">&quot;ROLE_dba &gt; ROLE_admin \n ROLE_admin &gt; ROLE_user&quot;</span>;</span><br><span class="line">    roleHierarchy.setHierarchy(hierarchy);</span><br><span class="line">    <span class="keyword">return</span> roleHierarchy;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å˜åŒ–ä¸»è¦å°±æ˜¯åˆ†éš”ç¬¦ï¼Œå°†åŸæ¥ç”¨ç©ºæ ¼éš”å¼€çš„åœ°æ–¹ï¼Œç°åœ¨ç”¨æ¢è¡Œç¬¦äº†ã€‚è¿™é‡Œè¡¨è¾¾å¼çš„å«ä¹‰ä¾ç„¶å’Œä¸Šé¢ä¸€æ ·ï¼Œä¸å†èµ˜è¿°ã€‚</p>
<p>ä¸Šé¢ä¸¤ç§ä¸åŒå†™æ³•éƒ½æ˜¯é…ç½®è§’è‰²çš„ç»§æ‰¿å…³ç³»ï¼Œé…ç½®å®Œæˆåï¼Œæ¥ä¸‹æ¥æŒ‡å®šè§’è‰²å’Œèµ„æºçš„å¯¹åº”å…³ç³»å³å¯ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    http.authorizeRequests().antMatchers(<span class="string">&quot;/admin/**&quot;</span>)</span><br><span class="line">            .hasRole(<span class="string">&quot;admin&quot;</span>)</span><br><span class="line">            .antMatchers(<span class="string">&quot;/db/**&quot;</span>)</span><br><span class="line">            .hasRole(<span class="string">&quot;dba&quot;</span>)</span><br><span class="line">            .antMatchers(<span class="string">&quot;/user/**&quot;</span>)</span><br><span class="line">            .hasRole(<span class="string">&quot;user&quot;</span>)</span><br><span class="line">            .and()</span><br><span class="line">            .formLogin()</span><br><span class="line">            .loginProcessingUrl(<span class="string">&quot;/doLogin&quot;</span>)</span><br><span class="line">            .permitAll()</span><br><span class="line">            .and()</span><br><span class="line">            .csrf().disable();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªè¡¨ç¤º <code>/db/**</code> æ ¼å¼çš„è·¯å¾„éœ€è¦å…·å¤‡ dba è§’è‰²æ‰èƒ½è®¿é—®ï¼Œ <code>/admin/**</code> æ ¼å¼çš„è·¯å¾„åˆ™éœ€è¦å…·å¤‡ admin è§’è‰²æ‰èƒ½è®¿é—®ï¼Œ <code>/user/**</code> æ ¼å¼çš„è·¯å¾„ï¼Œåˆ™éœ€è¦å…·å¤‡ user è§’è‰²æ‰èƒ½è®¿é—®ï¼Œæ­¤æ—¶æä¾›ç›¸å…³æ¥å£ï¼Œä¼šå‘ç°ï¼Œdba é™¤äº†è®¿é—® <code>/db/**</code> ï¼Œä¹Ÿèƒ½è®¿é—® <code>/admin/**</code> å’Œ <code>/user/**</code> ï¼Œadmin è§’è‰²é™¤äº†è®¿é—® <code>/admin/**</code> ï¼Œä¹Ÿèƒ½è®¿é—® <code>/user/**</code> ï¼Œuser è§’è‰²åˆ™åªèƒ½è®¿é—® <code>/user/**</code> ã€‚</p>
<h3 id="æºç åˆ†æ"><a href="#æºç åˆ†æ" class="headerlink" title="æºç åˆ†æ"></a>æºç åˆ†æ</h3><p>è¿™æ ·ä¸¤ç§ä¸åŒçš„å†™æ³•ï¼Œå…¶å®ä¹Ÿå¯¹åº”äº†ä¸¤ç§ä¸åŒçš„è§£æç­–ç•¥ï¼Œè§’è‰²ç»§æ‰¿å…³ç³»çš„è§£æåœ¨ RoleHierarchyImpl ç±»çš„ buildRolesReachableInOneStepMap æ–¹æ³•ä¸­ï¼ŒSpring Boot2.0.8ï¼ˆå«ï¼‰ä¹‹å‰è¯¥æ–¹æ³•çš„æºç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">buildRolesReachableInOneStepMap</span><span class="params">()</span> &#123;</span><br><span class="line">	<span class="type">Pattern</span> <span class="variable">pattern</span> <span class="operator">=</span> Pattern.compile(<span class="string">&quot;(\\s*([^\\s&gt;]+)\\s*&gt;\\s*([^\\s&gt;]+))&quot;</span>);</span><br><span class="line">	<span class="type">Matcher</span> <span class="variable">roleHierarchyMatcher</span> <span class="operator">=</span> pattern</span><br><span class="line">			.matcher(<span class="built_in">this</span>.roleHierarchyStringRepresentation);</span><br><span class="line">	<span class="built_in">this</span>.rolesReachableInOneStepMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;GrantedAuthority, Set&lt;GrantedAuthority&gt;&gt;();</span><br><span class="line">	<span class="keyword">while</span> (roleHierarchyMatcher.find()) &#123;</span><br><span class="line">		<span class="type">GrantedAuthority</span> <span class="variable">higherRole</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleGrantedAuthority</span>(</span><br><span class="line">				roleHierarchyMatcher.group(<span class="number">2</span>));</span><br><span class="line">		<span class="type">GrantedAuthority</span> <span class="variable">lowerRole</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleGrantedAuthority</span>(</span><br><span class="line">				roleHierarchyMatcher.group(<span class="number">3</span>));</span><br><span class="line">		Set&lt;GrantedAuthority&gt; rolesReachableInOneStepSet;</span><br><span class="line">		<span class="keyword">if</span> (!<span class="built_in">this</span>.rolesReachableInOneStepMap.containsKey(higherRole)) &#123;</span><br><span class="line">			rolesReachableInOneStepSet = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">			<span class="built_in">this</span>.rolesReachableInOneStepMap.put(higherRole,</span><br><span class="line">					rolesReachableInOneStepSet);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> &#123;</span><br><span class="line">			rolesReachableInOneStepSet = <span class="built_in">this</span>.rolesReachableInOneStepMap</span><br><span class="line">					.get(higherRole);</span><br><span class="line">		&#125;</span><br><span class="line">		addReachableRoles(rolesReachableInOneStepSet, lowerRole);</span><br><span class="line">		logger.debug(<span class="string">&quot;buildRolesReachableInOneStepMap() - From role &quot;</span> + higherRole</span><br><span class="line">				+ <span class="string">&quot; one can reach role &quot;</span> + lowerRole + <span class="string">&quot; in one step.&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä»è¿™æ®µæºç ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œè§’è‰²çš„ç»§æ‰¿å…³ç³»æ˜¯é€šè¿‡æ­£åˆ™è¡¨è¾¾å¼è¿›è¡Œè§£æï¼Œé€šè¿‡ç©ºæ ¼è¿›è¡Œåˆ‡åˆ†ï¼Œç„¶åæ„å»ºç›¸åº”çš„ map å‡ºæ¥ã€‚</p>
<p>Spring Boot2.1.0ï¼ˆå«ï¼‰ä¹‹åè¯¥æ–¹æ³•çš„æºç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">buildRolesReachableInOneStepMap</span><span class="params">()</span> &#123;</span><br><span class="line">	<span class="built_in">this</span>.rolesReachableInOneStepMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;GrantedAuthority, Set&lt;GrantedAuthority&gt;&gt;();</span><br><span class="line">	<span class="keyword">try</span> (<span class="type">BufferedReader</span> <span class="variable">bufferedReader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(</span><br><span class="line">			<span class="keyword">new</span> <span class="title class_">StringReader</span>(<span class="built_in">this</span>.roleHierarchyStringRepresentation))) &#123;</span><br><span class="line">		<span class="keyword">for</span> (String readLine; (readLine = bufferedReader.readLine()) != <span class="literal">null</span>;) &#123;</span><br><span class="line">			String[] roles = readLine.split(<span class="string">&quot; &gt; &quot;</span>);</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; roles.length; i++) &#123;</span><br><span class="line">				<span class="type">GrantedAuthority</span> <span class="variable">higherRole</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleGrantedAuthority</span>(</span><br><span class="line">						roles[i - <span class="number">1</span>].replaceAll(<span class="string">&quot;^\\s+|\\s+$&quot;</span>, <span class="string">&quot;&quot;</span>));</span><br><span class="line">				<span class="type">GrantedAuthority</span> <span class="variable">lowerRole</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleGrantedAuthority</span>(roles[i].replaceAll(<span class="string">&quot;^\\s+|\\s+$</span></span><br><span class="line"><span class="string">				Set&lt;GrantedAuthority&gt; rolesReachableInOneStepSet;</span></span><br><span class="line"><span class="string">				if (!this.rolesReachableInOneStepMap.containsKey(higherRole)) &#123;</span></span><br><span class="line"><span class="string">					rolesReachableInOneStepSet = new HashSet&lt;GrantedAuthority&gt;();</span></span><br><span class="line"><span class="string">					this.rolesReachableInOneStepMap.put(higherRole, rolesReachableInOneStepSet);</span></span><br><span class="line"><span class="string">				&#125; else &#123;</span></span><br><span class="line"><span class="string">					rolesReachableInOneStepSet = this.rolesReachableInOneStepMap.get(higherRole);</span></span><br><span class="line"><span class="string">				&#125;</span></span><br><span class="line"><span class="string">				addReachableRoles(rolesReachableInOneStepSet, lowerRole);</span></span><br><span class="line"><span class="string">				if (logger.isDebugEnabled()) &#123;</span></span><br><span class="line"><span class="string">					logger.debug(&quot;</span>buildRolesReachableInOneStepMap() - From role <span class="string">&quot; + higherRole</span></span><br><span class="line"><span class="string">							+ &quot;</span> one can reach role <span class="string">&quot; + lowerRole + &quot;</span> in one step.<span class="string">&quot;);</span></span><br><span class="line"><span class="string">				&#125;</span></span><br><span class="line"><span class="string">			&#125;</span></span><br><span class="line"><span class="string">		&#125;</span></span><br><span class="line"><span class="string">	&#125; catch (IOException e) &#123;</span></span><br><span class="line"><span class="string">		throw new IllegalStateException(e);</span></span><br><span class="line"><span class="string">	&#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>

<p>ä»è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œå¹¶æ²¡æœ‰ä¸€ä¸Šæ¥å°±æ˜¯ç”¨æ­£åˆ™è¡¨è¾¾å¼ï¼Œè€Œæ˜¯å…ˆå°†è§’è‰²ç»§æ‰¿å­—ç¬¦ä¸²è½¬ä¸ºä¸€ä¸ª BufferedReader ï¼Œç„¶åä¸€è¡Œä¸€è¡Œçš„è¯»å‡ºæ¥ï¼Œå†è¿›è¡Œè§£æï¼Œæœ€åå†æ„å»ºç›¸åº”çš„ mapã€‚ä»è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºä¸ºä»€ä¹ˆå‰åç‰ˆæœ¬å¯¹æ­¤æœ‰ä¸åŒçš„å†™æ³•ã€‚</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2022-08-23T10:05:01.000Z" title="2022/8/23 ä¸‹åˆ6:05:01">2022-08-23</time>å‘è¡¨</span><span class="level-item"><time dateTime="2022-11-21T14:32:53.582Z" title="2022/11/21 ä¸‹åˆ10:32:53">2022-11-21</time>æ›´æ–°</span><span class="level-item"><a class="link-muted" href="/categories/spring-boot-spring-security/">spring-boot spring-security</a></span><span class="level-item">1 å°æ—¶è¯»å®Œ (å¤§çº¦7276ä¸ªå­—)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2022/08/23/01-security%E5%9F%BA%E7%A1%80%E9%85%8D%E7%BD%AE/">Spring Security åŸºæœ¬é…ç½®</a></h1><div class="content"><h2 id="1-æ–°å»ºé¡¹ç›®"><a href="#1-æ–°å»ºé¡¹ç›®" class="headerlink" title="1.æ–°å»ºé¡¹ç›®"></a>1.æ–°å»ºé¡¹ç›®</h2><p>é¦–å…ˆæ–°å»ºä¸€ä¸ª Spring Boot é¡¹ç›®ï¼Œåˆ›å»ºæ—¶å¼•å…¥ Spring Security ä¾èµ–å’Œ web ä¾èµ–</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-security<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>é¡¹ç›®åˆ›å»ºæˆåŠŸåï¼Œæˆ‘ä»¬æ·»åŠ ä¸€ä¸ªæµ‹è¯•çš„ HelloControllerï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/hello&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">hello</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;SECURITY&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ¥ä¸‹æ¥ä»€ä¹ˆäº‹æƒ…éƒ½ä¸ç”¨åšï¼Œæˆ‘ä»¬ç›´æ¥æ¥å¯åŠ¨é¡¹ç›®ã€‚</p>
<p>åœ¨é¡¹ç›®å¯åŠ¨è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ°å¦‚ä¸‹ä¸€è¡Œæ—¥å¿—ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Using generated security password: 30abfb1f-36e1-446a-a79b-f70024f589ab</span><br></pre></td></tr></table></figure>

<p>è¿™å°±æ˜¯ Spring Security ä¸ºé»˜è®¤ç”¨æˆ· user ç”Ÿæˆçš„ä¸´æ—¶å¯†ç ï¼Œæ˜¯ä¸€ä¸ª UUID å­—ç¬¦ä¸²ã€‚</p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬å»è®¿é—® <code>http://localhost:8080/hello</code> æ¥å£ï¼Œå°±å¯ä»¥çœ‹åˆ°è‡ªåŠ¨é‡å®šå‘åˆ°ç™»å½•é¡µé¢äº†</p>
<p>åœ¨ç™»å½•é¡µé¢ï¼Œé»˜è®¤çš„ç”¨æˆ·åå°±æ˜¯ userï¼Œé»˜è®¤çš„ç™»å½•å¯†ç åˆ™æ˜¯é¡¹ç›®å¯åŠ¨æ—¶æ§åˆ¶å°æ‰“å°å‡ºæ¥çš„å¯†ç ï¼Œè¾“å…¥ç”¨æˆ·åå¯†ç ä¹‹åï¼Œå°±ç™»å½•æˆåŠŸäº†ï¼Œç™»å½•æˆåŠŸåï¼Œæˆ‘ä»¬å°±å¯ä»¥è®¿é—®åˆ° &#x2F;hello æ¥å£äº†ã€‚</p>
<p>åœ¨ Spring Security ä¸­ï¼Œé»˜è®¤çš„ç™»å½•é¡µé¢å’Œç™»å½•æ¥å£ï¼Œéƒ½æ˜¯ <code>/login</code> ï¼Œåªä¸è¿‡ä¸€ä¸ªæ˜¯ get è¯·æ±‚ï¼ˆç™»å½•é¡µé¢ï¼‰ï¼Œå¦ä¸€ä¸ªæ˜¯ post è¯·æ±‚ï¼ˆç™»å½•æ¥å£ï¼‰ã€‚</p>
<p><strong>å¤§å®¶å¯ä»¥çœ‹åˆ°ï¼Œéå¸¸æ–¹ä¾¿ï¼Œä¸€ä¸ªä¾èµ–å°±ä¿æŠ¤äº†æ‰€æœ‰æ¥å£ã€‚</strong></p>
<p>æœ‰äººè¯´ï¼Œä½ æ€ä¹ˆçŸ¥é“çŸ¥é“ç”Ÿæˆçš„é»˜è®¤å¯†ç æ˜¯ä¸€ä¸ª UUID å‘¢ï¼Ÿ</p>
<p>è¿™ä¸ªå…¶å®å¾ˆå¥½åˆ¤æ–­ã€‚</p>
<p>å’Œç”¨æˆ·ç›¸å…³çš„è‡ªåŠ¨åŒ–é…ç½®ç±»åœ¨ <code>UserDetailsServiceAutoConfiguration</code> é‡Œè¾¹ï¼Œåœ¨è¯¥ç±»çš„ <code>getOrDeducePassword</code> æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°å¦‚ä¸‹ä¸€è¡Œæ—¥å¿—ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (user.isPasswordGenerated()) &#123;</span><br><span class="line">	logger.info(String.format(<span class="string">&quot;%n%nUsing generated security password: %s%n&quot;</span>, user.getPassword()));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ¯«æ— ç–‘é—®ï¼Œæˆ‘ä»¬åœ¨æ§åˆ¶å°çœ‹åˆ°çš„æ—¥å¿—å°±æ˜¯ä»è¿™é‡Œæ‰“å°å‡ºæ¥çš„ã€‚æ‰“å°çš„æ¡ä»¶æ˜¯ isPasswordGenerated æ–¹æ³•è¿”å› trueï¼Œå³å¯†ç æ˜¯é»˜è®¤ç”Ÿæˆçš„ã€‚</p>
<p>è¿›è€Œæˆ‘ä»¬å‘ç°ï¼Œuser.getPassword å‡ºç°åœ¨ SecurityProperties ä¸­ï¼Œåœ¨ SecurityProperties ä¸­æˆ‘ä»¬çœ‹åˆ°å¦‚ä¸‹å®šä¹‰ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Default user name.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> <span class="string">&quot;user&quot;</span>;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Password for the default user name.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> UUID.randomUUID().toString();</span><br><span class="line"><span class="keyword">private</span> <span class="type">boolean</span> <span class="variable">passwordGenerated</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°ï¼Œé»˜è®¤çš„ç”¨æˆ·åå°±æ˜¯ userï¼Œé»˜è®¤çš„å¯†ç åˆ™æ˜¯ UUIDï¼Œè€Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒpasswordGenerated ä¹Ÿä¸º trueã€‚</p>
<h2 id="2-ç”¨æˆ·é…ç½®"><a href="#2-ç”¨æˆ·é…ç½®" class="headerlink" title="2.ç”¨æˆ·é…ç½®"></a>2.ç”¨æˆ·é…ç½®</h2><p>é»˜è®¤çš„å¯†ç æœ‰ä¸€ä¸ªé—®é¢˜å°±æ˜¯æ¯æ¬¡é‡å¯é¡¹ç›®éƒ½ä¼šå˜ï¼Œè¿™å¾ˆä¸æ–¹ä¾¿ã€‚</p>
<p>åœ¨æ­£å¼ä»‹ç»æ•°æ®åº“è¿æ¥ä¹‹å‰ï¼Œæ¾å“¥å…ˆå’Œå¤§å®¶ä»‹ç»ä¸¤ç§éä¸»æµçš„ç”¨æˆ·å&#x2F;å¯†ç é…ç½®æ–¹æ¡ˆã€‚</p>
<h3 id="2-1-é…ç½®æ–‡ä»¶"><a href="#2-1-é…ç½®æ–‡ä»¶" class="headerlink" title="2.1 é…ç½®æ–‡ä»¶"></a>2.1 é…ç½®æ–‡ä»¶</h3><p>æˆ‘ä»¬å¯ä»¥åœ¨ application.properties ä¸­é…ç½®é»˜è®¤çš„ç”¨æˆ·åå¯†ç ã€‚</p>
<p>æ€ä¹ˆé…ç½®å‘¢ï¼Ÿå¤§å®¶è¿˜è®°å¾—ä¸Šä¸€å°èŠ‚æˆ‘ä»¬è¯´çš„ SecurityPropertiesï¼Œé»˜è®¤çš„ç”¨æˆ·å°±å®šä¹‰åœ¨å®ƒé‡Œè¾¹ï¼Œæ˜¯ä¸€ä¸ªé™æ€å†…éƒ¨ç±»ï¼Œæˆ‘ä»¬å¦‚æœè¦å®šä¹‰è‡ªå·±çš„ç”¨æˆ·åå¯†ç ï¼Œå¿…ç„¶æ˜¯è¦å»è¦†ç›–é»˜è®¤é…ç½®ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹ SecurityProperties çš„å®šä¹‰ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;spring.security&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SecurityProperties</span> &#123;</span><br></pre></td></tr></table></figure>

<p>è¿™å°±å¾ˆæ¸…æ™°äº†ï¼Œæˆ‘ä»¬åªéœ€è¦ä»¥ spring.security.user ä¸ºå‰ç¼€ï¼Œå»å®šä¹‰ç”¨æˆ·åå¯†ç å³å¯ï¼š</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.security.user.name</span>=<span class="string">user</span></span><br><span class="line"><span class="attr">spring.security.user.password</span>=<span class="string">123</span></span><br><span class="line"><span class="attr">spring.security.user.roles</span>=<span class="string">admin</span></span><br></pre></td></tr></table></figure>

<p>è¿™å°±æ˜¯æˆ‘ä»¬æ–°å®šä¹‰çš„ç”¨æˆ·åå¯†ç ã€‚</p>
<p>åœ¨ properties ä¸­å®šä¹‰çš„ç”¨æˆ·åå¯†ç æœ€ç»ˆæ˜¯é€šè¿‡ set æ–¹æ³•æ³¨å…¥åˆ°å±æ€§ä¸­å»çš„ï¼Œè¿™é‡Œæˆ‘ä»¬é¡ºä¾¿æ¥çœ‹ä¸‹ SecurityProperties.User#setPassword æ–¹æ³•:</p>
<p>ä»è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œapplication.properties ä¸­å®šä¹‰çš„å¯†ç åœ¨æ³¨å…¥è¿›æ¥ä¹‹åï¼Œè¿˜é¡ºä¾¿è®¾ç½®äº† passwordGenerated å±æ€§ä¸º falseï¼Œè¿™ä¸ªå±æ€§è®¾ç½®ä¸º false ä¹‹åï¼Œæ§åˆ¶å°å°±ä¸ä¼šæ‰“å°é»˜è®¤çš„å¯†ç äº†ã€‚</p>
<p>æ­¤æ—¶é‡å¯é¡¹ç›®ï¼Œå°±å¯ä»¥ä½¿ç”¨è‡ªå·±å®šä¹‰çš„ç”¨æˆ·å&#x2F;å¯†ç ç™»å½•äº†ã€‚</p>
<h3 id="2-2-é…ç½®ç±»"><a href="#2-2-é…ç½®ç±»" class="headerlink" title="2.2 é…ç½®ç±»"></a>2.2 é…ç½®ç±»</h3><p>é™¤äº†ä¸Šé¢çš„é…ç½®æ–‡ä»¶è¿™ç§æ–¹å¼ä¹‹å¤–ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨é…ç½®ç±»ä¸­é…ç½®ç”¨æˆ·å&#x2F;å¯†ç ã€‚</p>
<p>åœ¨é…ç½®ç±»ä¸­é…ç½®ï¼Œæˆ‘ä»¬å°±è¦æŒ‡å®š PasswordEncoder äº†ï¼Œè¿™æ˜¯ä¸€ä¸ªéå¸¸å…³é”®çš„ä¸œè¥¿ã€‚</p>
<p>è€ƒè™‘åˆ°æœ‰çš„å°ä¼™ä¼´å¯¹äº PasswordEncoder è¿˜ä¸å¤ªç†Ÿæ‚‰ï¼Œå› æ­¤ï¼Œæˆ‘è¿™é‡Œå…ˆç¨å¾®ç»™å¤§å®¶ä»‹ç»ä¸€ä¸‹ PasswordEncoder åˆ°åº•æ˜¯å¹²å˜›ç”¨çš„ã€‚è¦è¯´ PasswordEncoder ï¼Œå°±å¾—å…ˆè¯´å¯†ç åŠ å¯†ã€‚</p>
<h4 id="2-2-1-ä¸ºä»€ä¹ˆè¦åŠ å¯†"><a href="#2-2-1-ä¸ºä»€ä¹ˆè¦åŠ å¯†" class="headerlink" title="2.2.1 ä¸ºä»€ä¹ˆè¦åŠ å¯†"></a>2.2.1 ä¸ºä»€ä¹ˆè¦åŠ å¯†</h4><p>2011 å¹´ 12 æœˆ 21 æ—¥ï¼Œæœ‰äººåœ¨ç½‘ç»œä¸Šå…¬å¼€äº†ä¸€ä¸ªåŒ…å« 600 ä¸‡ä¸ª CSDN ç”¨æˆ·èµ„æ–™çš„æ•°æ®åº“ï¼Œæ•°æ®å…¨éƒ¨ä¸ºæ˜æ–‡å‚¨å­˜ï¼ŒåŒ…å«ç”¨æˆ·åã€å¯†ç ä»¥åŠæ³¨å†Œé‚®ç®±ã€‚äº‹ä»¶å‘ç”Ÿå CSDN åœ¨å¾®åšã€å®˜æ–¹ç½‘ç«™ç­‰æ¸ é“å‘å‡ºäº†å£°æ˜ï¼Œè§£é‡Šè¯´æ­¤æ•°æ®åº“ç³» 2009 å¹´å¤‡ä»½æ‰€ç”¨ï¼Œå› ä¸æ˜åŸå› æ³„éœ²ï¼Œå·²ç»å‘è­¦æ–¹æŠ¥æ¡ˆï¼Œååˆåœ¨å®˜ç½‘å‘å‡ºäº†å…¬å¼€é“æ­‰ä¿¡ã€‚åœ¨æ¥ä¸‹æ¥çš„åå¤šå¤©é‡Œï¼Œé‡‘å±±ã€ç½‘æ˜“ã€äº¬ä¸œã€å½“å½“ã€æ–°æµªç­‰å¤šå®¶å…¬å¸è¢«å·å…¥åˆ°è¿™æ¬¡äº‹ä»¶ä¸­ã€‚æ•´ä¸ªäº‹ä»¶ä¸­æœ€è§¦ç›®æƒŠå¿ƒçš„è«è¿‡äº CSDN æŠŠç”¨æˆ·å¯†ç æ˜æ–‡å­˜å‚¨ï¼Œç”±äºå¾ˆå¤šç”¨æˆ·æ˜¯å¤šä¸ªç½‘ç«™å…±ç”¨ä¸€ä¸ªå¯†ç ï¼Œå› æ­¤ä¸€ä¸ªç½‘ç«™å¯†ç æ³„éœ²å°±ä¼šé€ æˆå¾ˆå¤§çš„å®‰å…¨éšæ‚£ã€‚ç”±äºæœ‰äº†è¿™ä¹ˆå¤šå‰è½¦ä¹‹é‰´ï¼Œæˆ‘ä»¬ç°åœ¨åšç³»ç»Ÿæ—¶ï¼Œå¯†ç éƒ½è¦åŠ å¯†å¤„ç†ã€‚</p>
<p>è¿™æ¬¡æ³„å¯†ï¼Œä¹Ÿç•™ä¸‹äº†ä¸€äº›æœ‰è¶£çš„äº‹æƒ…ï¼Œç‰¹åˆ«æ˜¯å¯¹äºå¹¿å¤§ç¨‹åºå‘˜è®¾ç½®å¯†ç è¿™ä¸€é¡¹ã€‚äººä»¬ä» CSDN æ³„å¯†çš„æ–‡ä»¶ä¸­ï¼Œå‘ç°äº†ä¸€äº›å¥½ç©çš„å¯†ç ï¼Œä¾‹å¦‚å¦‚ä¸‹è¿™äº›ï¼š</p>
<ul>
<li><code>ppnn13%dkstFeb.1st</code> è¿™æ®µå¯†ç çš„ä¸­æ–‡è§£ææ˜¯ï¼šå¨‰å¨‰è¢…è¢…åä¸‰ä½™ï¼Œè±†è”»æ¢¢å¤´äºŒæœˆåˆã€‚</li>
<li><code>csbt34.ydhl12s</code> è¿™æ®µå¯†ç çš„ä¸­æ–‡è§£ææ˜¯ï¼šæ± ä¸Šç¢§è‹”ä¸‰å››ç‚¹ï¼Œå¶åº•é»„é¹‚ä¸€ä¸¤å£°</li>
<li>â€¦</li>
</ul>
<p>ç­‰ç­‰ä¸ä¸€è€Œè¶³ï¼Œä½ ä¼šå‘ç°å¾ˆå¤šç¨‹åºå‘˜çš„äººæ–‡ç´ å…»è¿˜æ˜¯éå¸¸é«˜çš„ï¼Œè®©äººå•§å•§ç§°å¥‡ã€‚</p>
<h4 id="2-2-2-åŠ å¯†æ–¹æ¡ˆ"><a href="#2-2-2-åŠ å¯†æ–¹æ¡ˆ" class="headerlink" title="2.2.2 åŠ å¯†æ–¹æ¡ˆ"></a>2.2.2 åŠ å¯†æ–¹æ¡ˆ</h4><p>å¯†ç åŠ å¯†æˆ‘ä»¬ä¸€èˆ¬ä¼šç”¨åˆ°æ•£åˆ—å‡½æ•°ï¼Œåˆç§°æ•£åˆ—ç®—æ³•ã€å“ˆå¸Œå‡½æ•°ï¼Œè¿™æ˜¯ä¸€ç§ä»ä»»ä½•æ•°æ®ä¸­åˆ›å»ºæ•°å­—â€œæŒ‡çº¹â€çš„æ–¹æ³•ã€‚æ•£åˆ—å‡½æ•°æŠŠæ¶ˆæ¯æˆ–æ•°æ®å‹ç¼©æˆæ‘˜è¦ï¼Œä½¿å¾—æ•°æ®é‡å˜å°ï¼Œå°†æ•°æ®çš„æ ¼å¼å›ºå®šä¸‹æ¥ï¼Œç„¶åå°†æ•°æ®æ‰“ä¹±æ··åˆï¼Œé‡æ–°åˆ›å»ºä¸€ä¸ªæ•£åˆ—å€¼ã€‚æ•£åˆ—å€¼é€šå¸¸ç”¨ä¸€ä¸ªçŸ­çš„éšæœºå­—æ¯å’Œæ•°å­—ç»„æˆçš„å­—ç¬¦ä¸²æ¥ä»£è¡¨ã€‚å¥½çš„æ•£åˆ—å‡½æ•°åœ¨è¾“å…¥åŸŸä¸­å¾ˆå°‘å‡ºç°æ•£åˆ—å†²çªã€‚åœ¨æ•£åˆ—è¡¨å’Œæ•°æ®å¤„ç†ä¸­ï¼Œä¸æŠ‘åˆ¶å†²çªæ¥åŒºåˆ«æ•°æ®ï¼Œä¼šä½¿å¾—æ•°æ®åº“è®°å½•æ›´éš¾æ‰¾åˆ°ã€‚æˆ‘ä»¬å¸¸ç”¨çš„æ•£åˆ—å‡½æ•°æœ‰ MD5 æ¶ˆæ¯æ‘˜è¦ç®—æ³•ã€å®‰å…¨æ•£åˆ—ç®—æ³•ï¼ˆSecure Hash Algorithmï¼‰ã€‚</p>
<p>ä½†æ˜¯ä»…ä»…ä½¿ç”¨æ•£åˆ—å‡½æ•°è¿˜ä¸å¤Ÿï¼Œä¸ºäº†å¢åŠ å¯†ç çš„å®‰å…¨æ€§ï¼Œä¸€èˆ¬åœ¨å¯†ç åŠ å¯†è¿‡ç¨‹ä¸­è¿˜éœ€è¦åŠ ç›ï¼Œæ‰€è°“çš„ç›å¯ä»¥æ˜¯ä¸€ä¸ªéšæœºæ•°ä¹Ÿå¯ä»¥æ˜¯ç”¨æˆ·åï¼ŒåŠ ç›ä¹‹åï¼Œå³ä½¿å¯†ç æ˜æ–‡ç›¸åŒçš„ç”¨æˆ·ç”Ÿæˆçš„å¯†ç å¯†æ–‡ä¹Ÿä¸ç›¸åŒï¼Œè¿™å¯ä»¥æå¤§çš„æé«˜å¯†ç çš„å®‰å…¨æ€§ã€‚ä½†æ˜¯ä¼ ç»Ÿçš„åŠ ç›æ–¹å¼éœ€è¦åœ¨æ•°æ®åº“ä¸­æœ‰ä¸“é—¨çš„å­—æ®µæ¥è®°å½•ç›å€¼ï¼Œè¿™ä¸ªå­—æ®µå¯èƒ½æ˜¯ç”¨æˆ·åå­—æ®µï¼ˆå› ä¸ºç”¨æˆ·åå”¯ä¸€ï¼‰ï¼Œä¹Ÿå¯èƒ½æ˜¯ä¸€ä¸ªä¸“é—¨è®°å½•ç›å€¼çš„å­—æ®µï¼Œè¿™æ ·çš„é…ç½®æ¯”è¾ƒç¹çã€‚</p>
<p>Spring Security æä¾›äº†å¤šç§å¯†ç åŠ å¯†æ–¹æ¡ˆï¼Œå®˜æ–¹æ¨èä½¿ç”¨ BCryptPasswordEncoderï¼ŒBCryptPasswordEncoder ä½¿ç”¨ BCrypt å¼ºå“ˆå¸Œå‡½æ•°ï¼Œå¼€å‘è€…åœ¨ä½¿ç”¨æ—¶å¯ä»¥é€‰æ‹©æä¾› strength å’Œ SecureRandom å®ä¾‹ã€‚strength è¶Šå¤§ï¼Œå¯†é’¥çš„è¿­ä»£æ¬¡æ•°è¶Šå¤šï¼Œå¯†é’¥è¿­ä»£æ¬¡æ•°ä¸º 2^strengthã€‚strength å–å€¼åœ¨ 4~31 ä¹‹é—´ï¼Œé»˜è®¤ä¸º 10ã€‚</p>
<p>ä¸åŒäº Shiro ä¸­éœ€è¦è‡ªå·±å¤„ç†å¯†ç åŠ ç›ï¼Œåœ¨ Spring Security ä¸­ï¼ŒBCryptPasswordEncoder å°±è‡ªå¸¦äº†ç›ï¼Œå¤„ç†èµ·æ¥éå¸¸æ–¹ä¾¿ã€‚</p>
<p>è€Œ BCryptPasswordEncoder å°±æ˜¯ PasswordEncoder æ¥å£çš„å®ç°ç±»ã€‚</p>
<h4 id="2-2-3-PasswordEncoder"><a href="#2-2-3-PasswordEncoder" class="headerlink" title="2.2.3 PasswordEncoder"></a>2.2.3 PasswordEncoder</h4><p>PasswordEncoder è¿™ä¸ªæ¥å£ä¸­å°±å®šä¹‰äº†ä¸‰ä¸ªæ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">PasswordEncoder</span> &#123;</span><br><span class="line">	String <span class="title function_">encode</span><span class="params">(CharSequence rawPassword)</span>;</span><br><span class="line">	<span class="type">boolean</span> <span class="title function_">matches</span><span class="params">(CharSequence rawPassword, String encodedPassword)</span>;</span><br><span class="line">	<span class="keyword">default</span> <span class="type">boolean</span> <span class="title function_">upgradeEncoding</span><span class="params">(String encodedPassword)</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol>
<li>encode æ–¹æ³•ç”¨æ¥å¯¹æ˜æ–‡å¯†ç è¿›è¡ŒåŠ å¯†ï¼Œè¿”å›åŠ å¯†ä¹‹åçš„å¯†æ–‡ã€‚</li>
<li>matches æ–¹æ³•æ˜¯ä¸€ä¸ªå¯†ç æ ¡å¯¹æ–¹æ³•ï¼Œåœ¨ç”¨æˆ·ç™»å½•çš„æ—¶å€™ï¼Œå°†ç”¨æˆ·ä¼ æ¥çš„æ˜æ–‡å¯†ç å’Œæ•°æ®åº“ä¸­ä¿å­˜çš„å¯†æ–‡å¯†ç ä½œä¸ºå‚æ•°ï¼Œä¼ å…¥åˆ°è¿™ä¸ªæ–¹æ³•ä¸­å»ï¼Œæ ¹æ®è¿”å›çš„ Boolean å€¼åˆ¤æ–­ç”¨æˆ·å¯†ç æ˜¯å¦è¾“å…¥æ­£ç¡®ã€‚</li>
<li>upgradeEncoding æ˜¯å¦è¿˜è¦è¿›è¡Œå†æ¬¡åŠ å¯†ï¼Œè¿™ä¸ªä¸€èˆ¬æ¥è¯´å°±ä¸ç”¨äº†ã€‚</li>
</ol>
<h4 id="2-2-4-é…ç½®"><a href="#2-2-4-é…ç½®" class="headerlink" title="2.2.4 é…ç½®"></a>2.2.4 é…ç½®</h4><p>é¢„å¤‡çŸ¥è¯†è®²å®Œåï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æ¥çœ‹å…·ä½“å¦‚ä½•é…ç½®ï¼š</p>
<p><code>@EnableWebSecurity:æ‰å¯ç”Ÿæ•ˆ @Configurable ä¸ç”Ÿæ•ˆ</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableWebSecurity</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SecurityConfig</span> <span class="keyword">extends</span> <span class="title class_">WebSecurityConfigurerAdapter</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> PasswordEncoder <span class="title function_">passwordEncoder</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> NoOpPasswordEncoder.getInstance();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(AuthenticationManagerBuilder auth)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        auth.inMemoryAuthentication().withUser(<span class="string">&quot;admin&quot;</span>).password(passwordEncoder().encode(<span class="string">&quot;123&quot;</span>)).roles(<span class="string">&quot;admin&quot;</span>).authorities(<span class="string">&quot;index&quot;</span>,<span class="string">&quot;detail&quot;</span>);</span><br><span class="line">        auth.inMemoryAuthentication().withUser(<span class="string">&quot;user&quot;</span>).password(passwordEncoder().encode(<span class="string">&quot;123&quot;</span>)).roles(<span class="string">&quot;user&quot;</span>).authorities(<span class="string">&quot;index&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol>
<li>é¦–å…ˆæˆ‘ä»¬è‡ªå®šä¹‰ SecurityConfig ç»§æ‰¿è‡ª WebSecurityConfigurerAdapterï¼Œé‡å†™é‡Œè¾¹çš„ configure æ–¹æ³•ã€‚</li>
<li>é¦–å…ˆæˆ‘ä»¬æä¾›äº†ä¸€ä¸ª PasswordEncoder çš„å®ä¾‹ï¼Œå› ä¸ºç›®å‰çš„æ¡ˆä¾‹è¿˜æ¯”è¾ƒç®€å•ï¼Œå› æ­¤æˆ‘æš‚æ—¶å…ˆä¸ç»™å¯†ç è¿›è¡ŒåŠ å¯†ï¼Œæ‰€ä»¥è¿”å› NoOpPasswordEncoder çš„å®ä¾‹å³å¯ã€‚</li>
<li>configure æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡ inMemoryAuthentication æ¥å¼€å¯åœ¨å†…å­˜ä¸­å®šä¹‰ç”¨æˆ·ï¼ŒwithUser ä¸­æ˜¯ç”¨æˆ·åï¼Œpassword ä¸­åˆ™æ˜¯ç”¨æˆ·å¯†ç ï¼Œroles ä¸­æ˜¯ç”¨æˆ·è§’è‰²ã€‚</li>
<li>å¦‚æœéœ€è¦é…ç½®å¤šä¸ªç”¨æˆ·ï¼Œç”¨ and ç›¸è¿ã€‚</li>
</ol>
<p>ä¸ºä»€ä¹ˆç”¨ and ç›¸è¿å‘¢ï¼Ÿ</p>
<blockquote>
<p>åœ¨æ²¡æœ‰ Spring Boot çš„æ—¶å€™ï¼Œæˆ‘ä»¬éƒ½æ˜¯ SSM ä¸­ä½¿ç”¨ Spring Securityï¼Œè¿™ç§æ—¶å€™éƒ½æ˜¯åœ¨ XML æ–‡ä»¶ä¸­é…ç½® Spring Securityï¼Œæ—¢ç„¶æ˜¯ XML æ–‡ä»¶ï¼Œæ ‡ç­¾å°±æœ‰å¼€å§‹æœ‰ç»“æŸï¼Œç°åœ¨çš„ and ç¬¦å·ç›¸å½“äºå°±æ˜¯ XML æ ‡ç­¾çš„ç»“æŸç¬¦ï¼Œè¡¨ç¤ºç»“æŸå½“å‰æ ‡ç­¾ï¼Œè¿™æ˜¯ä¸ªæ—¶å€™ä¸Šä¸‹æ–‡ä¼šå›åˆ° inMemoryAuthentication æ–¹æ³•ä¸­ï¼Œç„¶åå¼€å¯æ–°ç”¨æˆ·çš„é…ç½®ã€‚</p>
</blockquote>
<p>é…ç½®å®Œæˆåï¼Œå†æ¬¡å¯åŠ¨é¡¹ç›®ï¼ŒJava ä»£ç ä¸­çš„é…ç½®ä¼šè¦†ç›–æ‰ XML æ–‡ä»¶ä¸­çš„é…ç½®ï¼Œæ­¤æ—¶å†å»è®¿é—® &#x2F;hello æ¥å£ï¼Œå°±ä¼šå‘ç°åªæœ‰ Java ä»£ç ä¸­çš„ç”¨æˆ·å&#x2F;å¯†ç æ‰èƒ½è®¿é—®æˆåŠŸã€‚</p>
<h2 id="3-HttpSecurity-é…ç½®"><a href="#3-HttpSecurity-é…ç½®" class="headerlink" title="3.HttpSecurity é…ç½®"></a>3.HttpSecurity é…ç½®</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="comment">// è¯·æ±‚è§„åˆ™</span></span><br><span class="line">    http.authorizeRequests()</span><br><span class="line">            .antMatchers(<span class="string">&quot;/admin/**&quot;</span>).hasRole(<span class="string">&quot;admin&quot;</span>)</span><br><span class="line">            .antMatchers(<span class="string">&quot;/user/**&quot;</span>).hasAnyRole(<span class="string">&quot;user&quot;</span>,<span class="string">&quot;admin&quot;</span>)</span><br><span class="line">            <span class="comment">// æ‰€æœ‰è¯·æ±‚éƒ½è¿›è¡Œè®¤è¯</span></span><br><span class="line">            .anyRequest().authenticated()</span><br><span class="line">            .and()</span><br><span class="line">            <span class="comment">// å¼€å¯è¡¨å•ç™»é™†</span></span><br><span class="line">            .formLogin()</span><br><span class="line">            <span class="comment">// ç”¨æˆ·ç™»å½• URL</span></span><br><span class="line">            .loginProcessingUrl(<span class="string">&quot;/doLogin&quot;</span>)</span><br><span class="line">            <span class="comment">// ç™»å½•è¯·æ±‚éƒ½æ”¾è¡Œ</span></span><br><span class="line">            .permitAll()</span><br><span class="line">            .and()</span><br><span class="line">            <span class="comment">//å…³é—­ CSRF æ”»å‡»</span></span><br><span class="line">            .csrf().disable();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åˆ›å»ºä¸¤ä¸ªç”¨æˆ·è¯·æ±‚æ¥å£</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/admin/hello&quot;)</span></span><br><span class="line">String <span class="title function_">helloAdmin</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;hello admin&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@GetMapping(&quot;/user/hello&quot;)</span></span><br><span class="line">String <span class="title function_">userAdmin</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;hello user&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>é€šè¿‡ postman è¿›è¡Œè®¿é—®çš„æ—¶å€™ï¼Œè®¿é—® <code>/admin/user</code>çš„æ—¶å€™ï¼Œä¼šè·³è½¬åˆ°<code>loginé¡µé¢</code>è®©ä½ å»ç™»å½•ï¼Œæ­¤æ—¶å‘é€ <code>/doLoginã€ä¸Šé¢é…ç½®çš„ç™»å½•è¯·æ±‚URLã€‘</code>æ‹¼æ¥<code>?username=admin&amp;password=123</code>å°±ä¼šé‡å®šå‘åˆ° <code>/admin/user</code>ï¼Œæ­¤æ—¶å·²ç»æˆåŠŸç™»å½•ï¼Œsecurityå°±ä¼šæ”¾è¡Œè¯·æ±‚ã€‚</p>
<h2 id="4-è¡¨å•ç™»é™†è¯¦ç»†é…ç½®"><a href="#4-è¡¨å•ç™»é™†è¯¦ç»†é…ç½®" class="headerlink" title="4.è¡¨å•ç™»é™†è¯¦ç»†é…ç½®"></a>4.è¡¨å•ç™»é™†è¯¦ç»†é…ç½®</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="comment">// è¯·æ±‚è§„åˆ™</span></span><br><span class="line">    http.authorizeRequests()</span><br><span class="line">            .antMatchers(<span class="string">&quot;/admin/**&quot;</span>).hasRole(<span class="string">&quot;admin&quot;</span>)</span><br><span class="line">            .antMatchers(<span class="string">&quot;/user/**&quot;</span>).hasAnyRole(<span class="string">&quot;user&quot;</span>,<span class="string">&quot;admin&quot;</span>)</span><br><span class="line">            <span class="comment">// æ‰€æœ‰è¯·æ±‚éƒ½è¿›è¡Œè®¤è¯</span></span><br><span class="line">            .anyRequest().authenticated()</span><br><span class="line">            .and()</span><br><span class="line">            <span class="comment">// å¼€å¯è¡¨å•ç™»é™†</span></span><br><span class="line">            .formLogin()</span><br><span class="line">            <span class="comment">// ç”¨æˆ·ç™»å½•è¯·æ±‚ URL</span></span><br><span class="line">            .loginProcessingUrl(<span class="string">&quot;/doLogin&quot;</span>)</span><br><span class="line">            <span class="comment">// ç™»å½•é¡µé¢ URL</span></span><br><span class="line">            .loginPage(<span class="string">&quot;/login&quot;</span>)</span><br><span class="line">            <span class="comment">// è‡ªå®šä¹‰ç”¨æˆ·åå‚æ•°</span></span><br><span class="line">            .usernameParameter(<span class="string">&quot;uname&quot;</span>)</span><br><span class="line">            <span class="comment">// è‡ªå®šä¹‰å¯†ç å‚æ•°</span></span><br><span class="line">            .passwordParameter(<span class="string">&quot;passwd&quot;</span>)</span><br><span class="line">            <span class="comment">// ç™»é™†æˆåŠŸè·³è½¬çš„è¯·æ±‚</span></span><br><span class="line">            <span class="comment">//.successForwardUrl(&quot;/success/toPage&quot;)</span></span><br><span class="line">            <span class="comment">// ç™»é™†æˆåŠŸå¤„ç†å™¨[å‰åç«¯åˆ†ç¦»]</span></span><br><span class="line">            .successHandler((req,resp,auth)-&gt;&#123;</span><br><span class="line">                resp.setContentType(<span class="string">&quot;application/json;charset=utf-8&quot;</span>);</span><br><span class="line">                <span class="type">PrintWriter</span> <span class="variable">writer</span> <span class="operator">=</span> resp.getWriter();</span><br><span class="line">                HashMap&lt;String, Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">                map.put(<span class="string">&quot;status&quot;</span>,<span class="number">200</span>);</span><br><span class="line">                map.put(<span class="string">&quot;message&quot;</span>,auth.getPrincipal());</span><br><span class="line">                writer.write(<span class="keyword">new</span> <span class="title class_">ObjectMapper</span>().writeValueAsString(map));</span><br><span class="line">                writer.flush();</span><br><span class="line">                writer.close();</span><br><span class="line">            &#125;)</span><br><span class="line">            <span class="comment">// ç™»å½•å¤±è´¥é¡µé¢è·³è½¬é¡µé¢</span></span><br><span class="line">            <span class="comment">//.failureForwardUrl(&quot;/fail/toPage&quot;)</span></span><br><span class="line">            <span class="comment">// ç™»é™†å¤±è´¥å¤„ç†å™¨[å‰åç«¯åˆ†ç¦»]</span></span><br><span class="line">            .failureHandler((req,resp,e)-&gt;&#123;</span><br><span class="line">                resp.setContentType(<span class="string">&quot;application/json;charset=utf-8&quot;</span>);</span><br><span class="line">                <span class="type">PrintWriter</span> <span class="variable">writer</span> <span class="operator">=</span> resp.getWriter();</span><br><span class="line">                HashMap&lt;String, Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">                map.put(<span class="string">&quot;status&quot;</span>,<span class="number">401</span>);</span><br><span class="line">                <span class="keyword">if</span>(e <span class="keyword">instanceof</span> LockedException)&#123;</span><br><span class="line">                    map.put(<span class="string">&quot;message&quot;</span>,<span class="string">&quot;è´¦æˆ·è¢«é”å®š&quot;</span>);</span><br><span class="line">                &#125;<span class="keyword">else</span> <span class="keyword">if</span>(e <span class="keyword">instanceof</span> BadCredentialsException)&#123;</span><br><span class="line">                    map.put(<span class="string">&quot;message&quot;</span>,<span class="string">&quot;ç”¨æˆ·åæˆ–å¯†ç è¾“å…¥é”™è¯¯&quot;</span>);</span><br><span class="line">                &#125;<span class="keyword">else</span> <span class="keyword">if</span>(e <span class="keyword">instanceof</span> DisabledException)&#123;</span><br><span class="line">                    map.put(<span class="string">&quot;message&quot;</span>,<span class="string">&quot;è´¦æˆ·è¢«ç¦ç”¨&quot;</span>);</span><br><span class="line">                &#125;<span class="keyword">else</span> <span class="keyword">if</span>(e <span class="keyword">instanceof</span> AccountExpiredException)&#123;</span><br><span class="line">                    map.put(<span class="string">&quot;message&quot;</span>,<span class="string">&quot;è´¦æˆ·è¿‡æœŸ&quot;</span>);</span><br><span class="line">                &#125;<span class="keyword">else</span> <span class="keyword">if</span>(e <span class="keyword">instanceof</span> CredentialsExpiredException)&#123;</span><br><span class="line">                    map.put(<span class="string">&quot;message&quot;</span>,<span class="string">&quot;å¯†ç è¿‡æœŸ&quot;</span>);</span><br><span class="line">                &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                    map.put(<span class="string">&quot;message&quot;</span>,<span class="string">&quot;ç™»å½•å¤±è´¥&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                writer.write(<span class="keyword">new</span> <span class="title class_">ObjectMapper</span>().writeValueAsString(map));</span><br><span class="line">                writer.flush();</span><br><span class="line">                writer.close();</span><br><span class="line">            &#125;)</span><br><span class="line">            <span class="comment">// ç™»å½•è¯·æ±‚éƒ½æ”¾è¡Œ</span></span><br><span class="line">            .permitAll()</span><br><span class="line">            .and()</span><br><span class="line">            <span class="comment">//å…³é—­ CSRF æ”»å‡»</span></span><br><span class="line">            .csrf().disable();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è‡ªå®šä¹‰ç™»å½•é¡µé¢çš„æ¥å£</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/login&quot;)</span></span><br><span class="line">String <span class="title function_">userLogin</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;è¯·ç™»å½•&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>postman å‘é€è¯·æ±‚ <code>http://localhost:8080/admin/hello</code></p>
<p>é¡µé¢ä¼šè¿”å› <code>è¯·ç™»å½•</code>,è¿™æ˜¯å› ä¸ºè‡ªå®šä¹‰äº†å‰å¾€ç™»å½•é¡µçš„è¯·æ±‚<code>/login</code></p>
<p>å‘é€è¯·æ±‚ <code>http://localhost:8080/doLogin?uname=admin&amp;passwd=123</code></p>
<p>é¡µé¢è¿”å› JSON æ•°æ®</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;message&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;password&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;username&quot;</span><span class="punctuation">:</span> <span class="string">&quot;admin&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;authorities&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">            <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;authority&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ROLE_admin&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;accountNonExpired&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;accountNonLocked&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;credentialsNonExpired&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;enabled&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;status&quot;</span><span class="punctuation">:</span> <span class="number">200</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>å†æ¬¡è®¿é—®<code>http://localhost:8080/admin/hello</code></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hello admin</span><br></pre></td></tr></table></figure>

<h3 id="4-1-ç™»é™†æˆåŠŸå›è°ƒ"><a href="#4-1-ç™»é™†æˆåŠŸå›è°ƒ" class="headerlink" title="4.1 ç™»é™†æˆåŠŸå›è°ƒ"></a>4.1 ç™»é™†æˆåŠŸå›è°ƒ</h3><p>åœ¨ Spring Security ä¸­ï¼Œå’Œç™»å½•æˆåŠŸé‡å®šå‘ URL ç›¸å…³çš„æ–¹æ³•æœ‰ä¸¤ä¸ªï¼š</p>
<ul>
<li>defaultSuccessUrl</li>
<li>successForwardUrl</li>
</ul>
<p>è¿™ä¸¤ä¸ªå’‹çœ‹æ²¡ä»€ä¹ˆåŒºåˆ«ï¼Œå®é™…ä¸Šå†…è—ä¹¾å¤ã€‚</p>
<p>é¦–å…ˆæˆ‘ä»¬åœ¨é…ç½®çš„æ—¶å€™ï¼ŒdefaultSuccessUrl å’Œ successForwardUrl åªéœ€è¦é…ç½®ä¸€ä¸ªå³å¯ï¼Œå…·ä½“é…ç½®å“ªä¸ªï¼Œåˆ™è¦çœ‹ä½ çš„éœ€æ±‚ï¼Œä¸¤ä¸ªçš„åŒºåˆ«å¦‚ä¸‹ï¼š</p>
<ol>
<li>defaultSuccessUrl æœ‰ä¸€ä¸ªé‡è½½çš„æ–¹æ³•ï¼Œæˆ‘ä»¬å…ˆè¯´ä¸€ä¸ªå‚æ•°çš„ defaultSuccessUrl æ–¹æ³•ã€‚å¦‚æœæˆ‘ä»¬åœ¨ defaultSuccessUrl ä¸­æŒ‡å®šç™»å½•æˆåŠŸçš„è·³è½¬é¡µé¢ä¸º <code>/index</code>ï¼Œæ­¤æ—¶åˆ†ä¸¤ç§æƒ…å†µï¼Œå¦‚æœä½ æ˜¯ç›´æ¥åœ¨æµè§ˆå™¨ä¸­è¾“å…¥çš„ç™»å½•åœ°å€ï¼Œç™»å½•æˆåŠŸåï¼Œå°±ç›´æ¥è·³è½¬åˆ° <code>/index</code>ï¼Œå¦‚æœä½ æ˜¯åœ¨æµè§ˆå™¨ä¸­è¾“å…¥äº†å…¶ä»–åœ°å€ï¼Œä¾‹å¦‚ <code>http://localhost:8080/hello</code>ï¼Œç»“æœå› ä¸ºæ²¡æœ‰ç™»å½•ï¼Œåˆé‡å®šå‘åˆ°ç™»å½•é¡µé¢ï¼Œæ­¤æ—¶ç™»å½•æˆåŠŸåï¼Œå°±ä¸ä¼šæ¥åˆ° <code>/index</code> ï¼Œè€Œæ˜¯æ¥åˆ° <code>/hello</code> é¡µé¢ã€‚</li>
<li>defaultSuccessUrl è¿˜æœ‰ä¸€ä¸ªé‡è½½çš„æ–¹æ³•ï¼Œç¬¬äºŒä¸ªå‚æ•°å¦‚æœä¸è®¾ç½®é»˜è®¤ä¸º falseï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬ä¸Šé¢çš„çš„æƒ…å†µï¼Œå¦‚æœæ‰‹åŠ¨è®¾ç½®ç¬¬äºŒä¸ªå‚æ•°ä¸º trueï¼Œåˆ™ defaultSuccessUrl çš„æ•ˆæœå’Œ successForwardUrl ä¸€è‡´ã€‚</li>
<li>successForwardUrl è¡¨ç¤ºä¸ç®¡ä½ æ˜¯ä»å“ªé‡Œæ¥çš„ï¼Œç™»å½•åä¸€å¾‹è·³è½¬åˆ° successForwardUrl æŒ‡å®šçš„åœ°å€ã€‚ä¾‹å¦‚ successForwardUrl æŒ‡å®šçš„åœ°å€ä¸º <code>/index</code> ï¼Œä½ åœ¨æµè§ˆå™¨åœ°å€æ è¾“å…¥ <code>http://localhost:8080/hello</code>ï¼Œç»“æœå› ä¸ºæ²¡æœ‰ç™»å½•ï¼Œé‡å®šå‘åˆ°ç™»å½•é¡µé¢ï¼Œå½“ä½ ç™»å½•æˆåŠŸä¹‹åï¼Œå°±ä¼šæœåŠ¡ç«¯è·³è½¬åˆ° <code>/index</code> é¡µé¢ï¼›æˆ–è€…ä½ ç›´æ¥å°±åœ¨æµè§ˆå™¨è¾“å…¥äº†ç™»å½•é¡µé¢åœ°å€ï¼Œç™»å½•æˆåŠŸåä¹Ÿæ˜¯æ¥åˆ° <code>/index</code>ã€‚</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">.and()</span><br><span class="line">.formLogin()</span><br><span class="line">.loginPage(<span class="string">&quot;/login.html&quot;</span>)</span><br><span class="line">.loginProcessingUrl(<span class="string">&quot;/doLogin&quot;</span>)</span><br><span class="line">.usernameParameter(<span class="string">&quot;name&quot;</span>)</span><br><span class="line">.passwordParameter(<span class="string">&quot;passwd&quot;</span>)</span><br><span class="line">.defaultSuccessUrl(<span class="string">&quot;/index&quot;</span>)</span><br><span class="line">.successForwardUrl(<span class="string">&quot;/index&quot;</span>)</span><br><span class="line">.permitAll()</span><br><span class="line">.and()</span><br></pre></td></tr></table></figure>

<p><strong>ã€Œæ³¨æ„ï¼šå®é™…æ“ä½œä¸­ï¼ŒdefaultSuccessUrl å’Œ successForwardUrl åªéœ€è¦é…ç½®ä¸€ä¸ªå³å¯ã€‚ã€</strong></p>
<h3 id="4-2-ç™»å½•å¤±è´¥å›è°ƒ"><a href="#4-2-ç™»å½•å¤±è´¥å›è°ƒ" class="headerlink" title="4.2 ç™»å½•å¤±è´¥å›è°ƒ"></a>4.2 ç™»å½•å¤±è´¥å›è°ƒ</h3><p>ä¸ç™»å½•æˆåŠŸç›¸ä¼¼ï¼Œç™»å½•å¤±è´¥ä¹Ÿæ˜¯æœ‰ä¸¤ä¸ªæ–¹æ³•ï¼š</p>
<ul>
<li>failureForwardUrl</li>
<li>failureUrl</li>
</ul>
<p><strong>ã€Œè¿™ä¸¤ä¸ªæ–¹æ³•åœ¨è®¾ç½®çš„æ—¶å€™ä¹Ÿæ˜¯è®¾ç½®ä¸€ä¸ªå³å¯ã€</strong>ã€‚failureForwardUrl æ˜¯ç™»å½•å¤±è´¥ä¹‹åä¼šå‘ç”ŸæœåŠ¡ç«¯è·³è½¬ï¼ŒfailureUrl åˆ™åœ¨ç™»å½•å¤±è´¥ä¹‹åï¼Œä¼šå‘ç”Ÿé‡å®šå‘ã€‚</p>
<h3 id="4-3-æ³¨é”€ç™»å½•"><a href="#4-3-æ³¨é”€ç™»å½•" class="headerlink" title="4.3 æ³¨é”€ç™»å½•"></a>4.3 æ³¨é”€ç™»å½•</h3><p>æ³¨é”€ç™»å½•çš„é»˜è®¤æ¥å£æ˜¯ <code>/logout</code>ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é…ç½®ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">.and()</span><br><span class="line">.logout()</span><br><span class="line">.logoutUrl(<span class="string">&quot;/logout&quot;</span>)</span><br><span class="line">.logoutRequestMatcher(<span class="keyword">new</span> <span class="title class_">AntPathRequestMatcher</span>(<span class="string">&quot;/logout&quot;</span>,<span class="string">&quot;POST&quot;</span>))</span><br><span class="line">.logoutSuccessUrl(<span class="string">&quot;/index&quot;</span>)</span><br><span class="line">.deleteCookies()</span><br><span class="line">.clearAuthentication(<span class="literal">true</span>)</span><br><span class="line">.invalidateHttpSession(<span class="literal">true</span>)</span><br><span class="line">.permitAll()</span><br><span class="line">.and()</span><br></pre></td></tr></table></figure>

<p>æ³¨é”€ç™»å½•çš„é…ç½®æˆ‘æ¥è¯´ä¸€ä¸‹ï¼š</p>
<ol>
<li>é»˜è®¤æ³¨é”€çš„ URL æ˜¯ <code>/logout</code>ï¼Œæ˜¯ä¸€ä¸ª GET è¯·æ±‚ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ logoutUrl æ–¹æ³•æ¥ä¿®æ”¹é»˜è®¤çš„æ³¨é”€ URLã€‚</li>
<li>logoutRequestMatcher æ–¹æ³•ä¸ä»…å¯ä»¥ä¿®æ”¹æ³¨é”€ URLï¼Œè¿˜å¯ä»¥ä¿®æ”¹è¯·æ±‚æ–¹å¼ï¼Œå®é™…é¡¹ç›®ä¸­ï¼Œè¿™ä¸ªæ–¹æ³•å’Œ logoutUrl ä»»æ„è®¾ç½®ä¸€ä¸ªå³å¯ã€‚</li>
<li>logoutSuccessUrl è¡¨ç¤ºæ³¨é”€æˆåŠŸåè¦è·³è½¬çš„é¡µé¢ã€‚</li>
<li>deleteCookies ç”¨æ¥æ¸…é™¤ cookieã€‚</li>
<li>clearAuthentication å’Œ invalidateHttpSession åˆ†åˆ«è¡¨ç¤ºæ¸…é™¤è®¤è¯ä¿¡æ¯å’Œä½¿ HttpSession å¤±æ•ˆï¼Œé»˜è®¤å¯ä»¥ä¸ç”¨é…ç½®ï¼Œé»˜è®¤å°±ä¼šæ¸…é™¤ã€‚</li>
</ol>
<h3 id="4-4-å‰åç«¯åˆ†ç¦»ç™»å½•"><a href="#4-4-å‰åç«¯åˆ†ç¦»ç™»å½•" class="headerlink" title="4.4 å‰åç«¯åˆ†ç¦»ç™»å½•"></a>4.4 å‰åç«¯åˆ†ç¦»ç™»å½•</h3><h4 id="æ— çŠ¶æ€ç™»å½•"><a href="#æ— çŠ¶æ€ç™»å½•" class="headerlink" title="æ— çŠ¶æ€ç™»å½•"></a>æ— çŠ¶æ€ç™»å½•</h4><h5 id="ä»€ä¹ˆæ˜¯æœ‰çŠ¶æ€"><a href="#ä»€ä¹ˆæ˜¯æœ‰çŠ¶æ€" class="headerlink" title="ä»€ä¹ˆæ˜¯æœ‰çŠ¶æ€"></a>ä»€ä¹ˆæ˜¯æœ‰çŠ¶æ€</h5><p>æœ‰çŠ¶æ€æœåŠ¡ï¼Œå³æœåŠ¡ç«¯éœ€è¦è®°å½•æ¯æ¬¡ä¼šè¯çš„å®¢æˆ·ç«¯ä¿¡æ¯ï¼Œä»è€Œè¯†åˆ«å®¢æˆ·ç«¯èº«ä»½ï¼Œæ ¹æ®ç”¨æˆ·èº«ä»½è¿›è¡Œè¯·æ±‚çš„å¤„ç†ï¼Œå…¸å‹çš„è®¾è®¡å¦‚ Tomcat ä¸­çš„ Sessionã€‚ä¾‹å¦‚ç™»å½•ï¼šç”¨æˆ·ç™»å½•åï¼Œæˆ‘ä»¬æŠŠç”¨æˆ·çš„ä¿¡æ¯ä¿å­˜åœ¨æœåŠ¡ç«¯ session ä¸­ï¼Œå¹¶ä¸”ç»™ç”¨æˆ·ä¸€ä¸ª cookie å€¼ï¼Œè®°å½•å¯¹åº”çš„ sessionï¼Œç„¶åä¸‹æ¬¡è¯·æ±‚ï¼Œç”¨æˆ·æºå¸¦ cookie å€¼æ¥ï¼ˆè¿™ä¸€æ­¥æœ‰æµè§ˆå™¨è‡ªåŠ¨å®Œæˆï¼‰ï¼Œæˆ‘ä»¬å°±èƒ½è¯†åˆ«åˆ°å¯¹åº” sessionï¼Œä»è€Œæ‰¾åˆ°ç”¨æˆ·çš„ä¿¡æ¯ã€‚è¿™ç§æ–¹å¼ç›®å‰æ¥çœ‹æœ€æ–¹ä¾¿ï¼Œä½†æ˜¯ä¹Ÿæœ‰ä¸€äº›ç¼ºé™·ï¼Œå¦‚ä¸‹ï¼š</p>
<ul>
<li>æœåŠ¡ç«¯ä¿å­˜å¤§é‡æ•°æ®ï¼Œå¢åŠ æœåŠ¡ç«¯å‹åŠ›</li>
<li>æœåŠ¡ç«¯ä¿å­˜ç”¨æˆ·çŠ¶æ€ï¼Œä¸æ”¯æŒé›†ç¾¤åŒ–éƒ¨ç½²</li>
</ul>
<h5 id="ä»€ä¹ˆæ˜¯æ— çŠ¶æ€"><a href="#ä»€ä¹ˆæ˜¯æ— çŠ¶æ€" class="headerlink" title="ä»€ä¹ˆæ˜¯æ— çŠ¶æ€"></a>ä»€ä¹ˆæ˜¯æ— çŠ¶æ€</h5><p>å¾®æœåŠ¡é›†ç¾¤ä¸­çš„æ¯ä¸ªæœåŠ¡ï¼Œå¯¹å¤–æä¾›çš„éƒ½ä½¿ç”¨ RESTful é£æ ¼çš„æ¥å£ã€‚è€Œ RESTful é£æ ¼çš„ä¸€ä¸ªæœ€é‡è¦çš„è§„èŒƒå°±æ˜¯ï¼šæœåŠ¡çš„æ— çŠ¶æ€æ€§ï¼Œå³ï¼š</p>
<ul>
<li>æœåŠ¡ç«¯ä¸ä¿å­˜ä»»ä½•å®¢æˆ·ç«¯è¯·æ±‚è€…ä¿¡æ¯</li>
<li>å®¢æˆ·ç«¯çš„æ¯æ¬¡è¯·æ±‚å¿…é¡»å…·å¤‡è‡ªæè¿°ä¿¡æ¯ï¼Œé€šè¿‡è¿™äº›ä¿¡æ¯è¯†åˆ«å®¢æˆ·ç«¯èº«ä»½</li>
</ul>
<p>é‚£ä¹ˆè¿™ç§æ— çŠ¶æ€æ€§æœ‰å“ªäº›å¥½å¤„å‘¢ï¼Ÿ</p>
<ul>
<li>å®¢æˆ·ç«¯è¯·æ±‚ä¸ä¾èµ–æœåŠ¡ç«¯çš„ä¿¡æ¯ï¼Œå¤šæ¬¡è¯·æ±‚ä¸éœ€è¦å¿…é¡»è®¿é—®åˆ°åŒä¸€å°æœåŠ¡å™¨</li>
<li>æœåŠ¡ç«¯çš„é›†ç¾¤å’ŒçŠ¶æ€å¯¹å®¢æˆ·ç«¯é€æ˜</li>
<li>æœåŠ¡ç«¯å¯ä»¥ä»»æ„çš„è¿ç§»å’Œä¼¸ç¼©ï¼ˆå¯ä»¥æ–¹ä¾¿çš„è¿›è¡Œé›†ç¾¤åŒ–éƒ¨ç½²ï¼‰</li>
<li>å‡å°æœåŠ¡ç«¯å­˜å‚¨å‹åŠ›</li>
</ul>
<h5 id="å¦‚ä½•å®ç°æ— çŠ¶æ€"><a href="#å¦‚ä½•å®ç°æ— çŠ¶æ€" class="headerlink" title="å¦‚ä½•å®ç°æ— çŠ¶æ€"></a>å¦‚ä½•å®ç°æ— çŠ¶æ€</h5><p>æ— çŠ¶æ€ç™»å½•çš„æµç¨‹ï¼š</p>
<ul>
<li>é¦–å…ˆå®¢æˆ·ç«¯å‘é€è´¦æˆ·å&#x2F;å¯†ç åˆ°æœåŠ¡ç«¯è¿›è¡Œè®¤è¯</li>
<li>è®¤è¯é€šè¿‡åï¼ŒæœåŠ¡ç«¯å°†ç”¨æˆ·ä¿¡æ¯åŠ å¯†å¹¶ä¸”ç¼–ç æˆä¸€ä¸ª tokenï¼Œè¿”å›ç»™å®¢æˆ·ç«¯</li>
<li>ä»¥åå®¢æˆ·ç«¯æ¯æ¬¡å‘é€è¯·æ±‚ï¼Œéƒ½éœ€è¦æºå¸¦è®¤è¯çš„ token</li>
<li>æœåŠ¡ç«¯å¯¹å®¢æˆ·ç«¯å‘é€æ¥çš„ token è¿›è¡Œè§£å¯†ï¼Œåˆ¤æ–­æ˜¯å¦æœ‰æ•ˆï¼Œå¹¶ä¸”è·å–ç”¨æˆ·ç™»å½•ä¿¡æ¯</li>
</ul>
<h5 id="å„è‡ªä¼˜ç¼ºç‚¹"><a href="#å„è‡ªä¼˜ç¼ºç‚¹" class="headerlink" title="å„è‡ªä¼˜ç¼ºç‚¹"></a>å„è‡ªä¼˜ç¼ºç‚¹</h5><p>ä½¿ç”¨ session æœ€å¤§çš„ä¼˜ç‚¹åœ¨äºæ–¹ä¾¿ã€‚ä½ ä¸ç”¨åšè¿‡å¤šçš„å¤„ç†ï¼Œä¸€åˆ‡éƒ½æ˜¯é»˜è®¤çš„å³å¯ã€‚</p>
<p>ä½†æ˜¯ä½¿ç”¨ session æœ‰å¦å¤–ä¸€ä¸ªè‡´å‘½çš„é—®é¢˜å°±æ˜¯å¦‚æœä½ çš„å‰ç«¯æ˜¯ Androidã€iOSã€å°ç¨‹åºç­‰ï¼Œè¿™äº› App å¤©ç„¶çš„å°±æ²¡æœ‰ cookieï¼Œå¦‚æœéè¦ç”¨ sessionï¼Œå°±éœ€è¦è¿™äº›å·¥ç¨‹å¸ˆåœ¨å„è‡ªçš„è®¾å¤‡ä¸Šåšé€‚é…ï¼Œä¸€èˆ¬æ˜¯æ¨¡æ‹Ÿ cookieï¼Œä»è¿™ä¸ªè§’åº¦æ¥è¯´ï¼Œåœ¨ç§»åŠ¨ App éåœ°å¼€èŠ±çš„ä»Šå¤©ï¼Œæˆ‘ä»¬å•çº¯çš„ä¾èµ– session æ¥åšå®‰å…¨ç®¡ç†ï¼Œä¼¼ä¹ä¹Ÿä¸æ˜¯ç‰¹åˆ«ç†æƒ³ã€‚</p>
<p>è¿™ä¸ªæ—¶å€™ JWT è¿™æ ·çš„æ— çŠ¶æ€ç™»å½•å°±å±•ç¤ºå‡ºè‡ªå·±çš„ä¼˜åŠ¿äº†ï¼Œè¿™äº›ç™»å½•æ–¹å¼æ‰€ä¾èµ–çš„ token ä½ å¯ä»¥é€šè¿‡æ™®é€šå‚æ•°ä¼ é€’ï¼Œä¹Ÿå¯ä»¥é€šè¿‡è¯·æ±‚å¤´ä¼ é€’ï¼Œæ€ä¹ˆæ ·éƒ½è¡Œï¼Œå…·æœ‰å¾ˆå¼ºçš„çµæ´»æ€§ã€‚</p>
<p>ä¸è¿‡è¯è¯´å›æ¥ï¼Œå¦‚æœä½ çš„å‰åç«¯åˆ†ç¦»åªæ˜¯ç½‘é¡µ+æœåŠ¡ç«¯ï¼Œå…¶å®æ²¡å¿…è¦ä¸Šæ— çŠ¶æ€ç™»å½•ï¼ŒåŸºäº session æ¥åšå°±å¯ä»¥äº†ï¼Œçœäº‹åˆæ–¹ä¾¿ã€‚</p>
<h4 id="ç™»å½•äº¤äº’"><a href="#ç™»å½•äº¤äº’" class="headerlink" title="ç™»å½•äº¤äº’"></a>ç™»å½•äº¤äº’</h4><h5 id="å‰åç«¯åˆ†ç¦»çš„æ•°æ®äº¤äº’"><a href="#å‰åç«¯åˆ†ç¦»çš„æ•°æ®äº¤äº’" class="headerlink" title="å‰åç«¯åˆ†ç¦»çš„æ•°æ®äº¤äº’"></a>å‰åç«¯åˆ†ç¦»çš„æ•°æ®äº¤äº’</h5><p>åœ¨å‰åç«¯åˆ†ç¦»è¿™æ ·çš„å¼€å‘æ¶æ„ä¸‹ï¼Œå‰åç«¯çš„äº¤äº’éƒ½æ˜¯é€šè¿‡ JSON æ¥è¿›è¡Œï¼Œæ— è®ºç™»å½•æˆåŠŸè¿˜æ˜¯å¤±è´¥ï¼Œéƒ½ä¸ä¼šæœ‰ä»€ä¹ˆæœåŠ¡ç«¯è·³è½¬æˆ–è€…å®¢æˆ·ç«¯è·³è½¬ä¹‹ç±»ã€‚</p>
<p>ç™»å½•æˆåŠŸäº†ï¼ŒæœåŠ¡ç«¯å°±è¿”å›ä¸€æ®µç™»å½•æˆåŠŸçš„æç¤º JSON ç»™å‰ç«¯ï¼Œå‰ç«¯æ”¶åˆ°ä¹‹åï¼Œè¯¥è·³è½¬è¯¥å±•ç¤ºï¼Œç”±å‰ç«¯è‡ªå·±å†³å®šï¼Œå°±å’Œåç«¯æ²¡æœ‰å…³ç³»äº†ã€‚</p>
<p>ç™»å½•å¤±è´¥äº†ï¼ŒæœåŠ¡ç«¯å°±è¿”å›ä¸€æ®µç™»å½•å¤±è´¥çš„æç¤º JSON ç»™å‰ç«¯ï¼Œå‰ç«¯æ”¶åˆ°ä¹‹åï¼Œè¯¥è·³è½¬è¯¥å±•ç¤ºï¼Œç”±å‰ç«¯è‡ªå·±å†³å®šï¼Œä¹Ÿå’Œåç«¯æ²¡æœ‰å…³ç³»äº†ã€‚</p>
<p>é¦–å…ˆæŠŠè¿™æ ·çš„æ€è·¯ç¡®å®šäº†ï¼ŒåŸºäºè¿™æ ·çš„æ€è·¯ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ç™»å½•é…ç½®ã€‚</p>
<h5 id="ç™»å½•æˆåŠŸ"><a href="#ç™»å½•æˆåŠŸ" class="headerlink" title="ç™»å½•æˆåŠŸ"></a>ç™»å½•æˆåŠŸ</h5><p>ä¹‹å‰æˆ‘ä»¬é…ç½®ç™»å½•æˆåŠŸçš„å¤„ç†æ˜¯é€šè¿‡å¦‚ä¸‹ä¸¤ä¸ªæ–¹æ³•æ¥é…ç½®çš„ï¼š</p>
<ul>
<li>defaultSuccessUrl</li>
<li>successForwardUrl</li>
</ul>
<p>è¿™ä¸¤ä¸ªéƒ½æ˜¯é…ç½®è·³è½¬åœ°å€çš„ï¼Œé€‚ç”¨äºå‰åç«¯ä¸åˆ†çš„å¼€å‘ã€‚é™¤äº†è¿™ä¸¤ä¸ªæ–¹æ³•ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªå¿…æ€æŠ€ï¼Œé‚£å°±æ˜¯ successHandlerã€‚</p>
<p>successHandler çš„åŠŸèƒ½ååˆ†å¼ºå¤§ï¼Œç”šè‡³å·²ç»å›Šæ‹¬äº† defaultSuccessUrl å’Œ successForwardUrl çš„åŠŸèƒ½ã€‚æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">.successHandler((req, resp, authentication) -&gt; &#123;</span><br><span class="line">    <span class="type">Object</span> <span class="variable">principal</span> <span class="operator">=</span> authentication.getPrincipal();</span><br><span class="line">    resp.setContentType(<span class="string">&quot;application/json;charset=utf-8&quot;</span>);</span><br><span class="line">    <span class="type">PrintWriter</span> <span class="variable">out</span> <span class="operator">=</span> resp.getWriter();</span><br><span class="line">    out.write(<span class="keyword">new</span> <span class="title class_">ObjectMapper</span>().writeValueAsString(principal));</span><br><span class="line">    out.flush();</span><br><span class="line">    out.close();</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>successHandler æ–¹æ³•çš„å‚æ•°æ˜¯ä¸€ä¸ª AuthenticationSuccessHandler å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡ä¸­æˆ‘ä»¬è¦å®ç°çš„æ–¹æ³•æ˜¯ onAuthenticationSuccessã€‚</p>
<p>onAuthenticationSuccess æ–¹æ³•æœ‰ä¸‰ä¸ªå‚æ•°ï¼Œåˆ†åˆ«æ˜¯ï¼š</p>
<ul>
<li>HttpServletRequest</li>
<li>HttpServletResponse</li>
<li>Authentication</li>
</ul>
<p>æœ‰äº†å‰ä¸¤ä¸ªå‚æ•°ï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨è¿™é‡Œéšå¿ƒæ‰€æ¬²çš„è¿”å›æ•°æ®äº†ã€‚åˆ©ç”¨ HttpServletRequest æˆ‘ä»¬å¯ä»¥åšæœåŠ¡ç«¯è·³è½¬ï¼Œåˆ©ç”¨ HttpServletResponse æˆ‘ä»¬å¯ä»¥åšå®¢æˆ·ç«¯è·³è½¬ï¼Œå½“ç„¶ï¼Œä¹Ÿå¯ä»¥è¿”å› JSON æ•°æ®ã€‚</p>
<p>ç¬¬ä¸‰ä¸ª Authentication å‚æ•°åˆ™ä¿å­˜äº†æˆ‘ä»¬åˆšåˆšç™»å½•æˆåŠŸçš„ç”¨æˆ·ä¿¡æ¯ã€‚</p>
<p>é…ç½®å®Œæˆåï¼Œæˆ‘ä»¬å†å»ç™»å½•ï¼Œå°±å¯ä»¥çœ‹åˆ°ç™»å½•æˆåŠŸçš„ç”¨æˆ·ä¿¡æ¯é€šè¿‡ JSON è¿”å›åˆ°å‰ç«¯äº†ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span>		</span><br><span class="line">        <span class="attr">&quot;password&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;username&quot;</span><span class="punctuation">:</span> <span class="string">&quot;admin&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;authorities&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">            <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;authority&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ROLE_admin&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;accountNonExpired&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;accountNonLocked&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;credentialsNonExpired&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;enabled&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h5 id="ç™»å½•å¤±è´¥"><a href="#ç™»å½•å¤±è´¥" class="headerlink" title="ç™»å½•å¤±è´¥"></a>ç™»å½•å¤±è´¥</h5><p>ç™»å½•å¤±è´¥ä¹Ÿæœ‰ä¸€ä¸ªç±»ä¼¼çš„å›è°ƒï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">.failureHandler((req, resp, e) -&gt; &#123;</span><br><span class="line">    resp.setContentType(<span class="string">&quot;application/json;charset=utf-8&quot;</span>);</span><br><span class="line">    <span class="type">PrintWriter</span> <span class="variable">out</span> <span class="operator">=</span> resp.getWriter();</span><br><span class="line">    out.write(e.getMessage());</span><br><span class="line">    out.flush();</span><br><span class="line">    out.close();</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>å¤±è´¥çš„å›è°ƒä¹Ÿæ˜¯ä¸‰ä¸ªå‚æ•°ï¼Œå‰ä¸¤ä¸ªå°±ä¸ç”¨è¯´äº†ï¼Œç¬¬ä¸‰ä¸ªæ˜¯ä¸€ä¸ª Exceptionï¼Œå¯¹äºç™»å½•å¤±è´¥ï¼Œä¼šæœ‰ä¸åŒçš„åŸå› ï¼ŒException ä¸­åˆ™ä¿å­˜äº†ç™»å½•å¤±è´¥çš„åŸå› ï¼Œæˆ‘ä»¬å¯ä»¥å°†ä¹‹é€šè¿‡ JSON è¿”å›åˆ°å‰ç«¯ã€‚</p>
<p>å½“ç„¶å¤§å®¶ä¹Ÿçœ‹åˆ°ï¼Œåœ¨å¾®äººäº‹ä¸­ï¼Œæˆ‘è¿˜æŒ¨ä¸ªå»è¯†åˆ«äº†ä¸€ä¸‹å¼‚å¸¸çš„ç±»å‹ï¼Œæ ¹æ®ä¸åŒçš„å¼‚å¸¸ç±»å‹ï¼Œæˆ‘ä»¬å¯ä»¥ç»™ç”¨æˆ·ä¸€ä¸ªæ›´åŠ æ˜ç¡®çš„æç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">resp.setContentType(<span class="string">&quot;application/json;charset=utf-8&quot;</span>);</span><br><span class="line"><span class="type">PrintWriter</span> <span class="variable">out</span> <span class="operator">=</span> resp.getWriter();</span><br><span class="line"><span class="type">RespBean</span> <span class="variable">respBean</span> <span class="operator">=</span> RespBean.error(e.getMessage());</span><br><span class="line"><span class="keyword">if</span> (e <span class="keyword">instanceof</span> LockedException) &#123;</span><br><span class="line">    respBean.setMsg(<span class="string">&quot;è´¦æˆ·è¢«é”å®šï¼Œè¯·è”ç³»ç®¡ç†å‘˜!&quot;</span>);</span><br><span class="line">&#125; elseif (e <span class="keyword">instanceof</span> CredentialsExpiredException) &#123;</span><br><span class="line">    respBean.setMsg(<span class="string">&quot;å¯†ç è¿‡æœŸï¼Œè¯·è”ç³»ç®¡ç†å‘˜!&quot;</span>);</span><br><span class="line">&#125; elseif (e <span class="keyword">instanceof</span> AccountExpiredException) &#123;</span><br><span class="line">    respBean.setMsg(<span class="string">&quot;è´¦æˆ·è¿‡æœŸï¼Œè¯·è”ç³»ç®¡ç†å‘˜!&quot;</span>);</span><br><span class="line">&#125; elseif (e <span class="keyword">instanceof</span> DisabledException) &#123;</span><br><span class="line">    respBean.setMsg(<span class="string">&quot;è´¦æˆ·è¢«ç¦ç”¨ï¼Œè¯·è”ç³»ç®¡ç†å‘˜!&quot;</span>);</span><br><span class="line">&#125; elseif (e <span class="keyword">instanceof</span> BadCredentialsException) &#123;</span><br><span class="line">    respBean.setMsg(<span class="string">&quot;ç”¨æˆ·åæˆ–è€…å¯†ç è¾“å…¥é”™è¯¯ï¼Œè¯·é‡æ–°è¾“å…¥!&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">out.write(<span class="keyword">new</span> <span class="title class_">ObjectMapper</span>().writeValueAsString(respBean));</span><br><span class="line">out.flush();</span><br><span class="line">out.close();</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œæœ‰ä¸€ä¸ªéœ€è¦æ³¨æ„çš„ç‚¹ã€‚</p>
<p>æˆ‘ä»¬çŸ¥é“ï¼Œå½“ç”¨æˆ·ç™»å½•æ—¶ï¼Œç”¨æˆ·åæˆ–è€…å¯†ç è¾“å…¥é”™è¯¯ï¼Œæˆ‘ä»¬ä¸€èˆ¬åªç»™ä¸€ä¸ªæ¨¡ç³Šçš„æç¤ºï¼Œå³<strong>ã€Œç”¨æˆ·åæˆ–è€…å¯†ç è¾“å…¥é”™è¯¯ï¼Œè¯·é‡æ–°è¾“å…¥ã€</strong>ï¼Œè€Œä¸ä¼šç»™ä¸€ä¸ªæ˜ç¡®çš„è¯¸å¦‚â€œç”¨æˆ·åè¾“å…¥é”™è¯¯â€æˆ–â€œå¯†ç è¾“å…¥é”™è¯¯â€è¿™æ ·ç²¾ç¡®çš„æç¤ºï¼Œä½†æ˜¯å¯¹äºå¾ˆå¤šä¸æ‡‚è¡Œçš„æ–°æ‰‹å°ä¼™ä¼´ï¼Œä»–å¯èƒ½å°±ä¼šç»™ä¸€ä¸ªæ˜ç¡®çš„é”™è¯¯æç¤ºï¼Œè¿™ä¼šç»™ç³»ç»Ÿå¸¦æ¥é£é™©ã€‚</p>
<p>ä½†æ˜¯ä½¿ç”¨äº† Spring Security è¿™æ ·çš„å®‰å…¨ç®¡ç†æ¡†æ¶ä¹‹åï¼Œå³ä½¿ä½ æ˜¯ä¸€ä¸ªæ–°æ‰‹ï¼Œä¹Ÿä¸ä¼šçŠ¯è¿™æ ·çš„é”™è¯¯ã€‚</p>
<p>åœ¨ Spring Security ä¸­ï¼Œç”¨æˆ·åæŸ¥æ‰¾å¤±è´¥å¯¹åº”çš„å¼‚å¸¸æ˜¯ï¼š</p>
<ul>
<li>UsernameNotFoundException</li>
</ul>
<p>å¯†ç åŒ¹é…å¤±è´¥å¯¹åº”çš„å¼‚å¸¸æ˜¯ï¼š</p>
<ul>
<li>BadCredentialsException</li>
</ul>
<p>ä½†æ˜¯æˆ‘ä»¬åœ¨ç™»å½•å¤±è´¥çš„å›è°ƒä¸­ï¼Œå´æ€»æ˜¯çœ‹ä¸åˆ° UsernameNotFoundException å¼‚å¸¸ï¼Œæ— è®ºç”¨æˆ·åè¿˜æ˜¯å¯†ç è¾“å…¥é”™è¯¯ï¼ŒæŠ›å‡ºçš„å¼‚å¸¸éƒ½æ˜¯ BadCredentialsExceptionã€‚</p>
<p>åœ¨ç™»å½•ä¸­æœ‰ä¸€ä¸ªå…³é”®çš„æ­¥éª¤ï¼Œå°±æ˜¯å»åŠ è½½ç”¨æˆ·æ•°æ®ï¼Œæˆ‘ä»¬å†æ¥æŠŠè¿™ä¸ªæ–¹æ³•æ‹å‡ºæ¥çœ‹ä¸€ä¸‹ï¼ˆéƒ¨åˆ†ï¼‰ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Authentication <span class="title function_">authenticate</span><span class="params">(Authentication authentication)</span></span><br><span class="line">		<span class="keyword">throws</span> AuthenticationException &#123;</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">		user = retrieveUser(username,</span><br><span class="line">				(UsernamePasswordAuthenticationToken) authentication);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">catch</span> (UsernameNotFoundException notFound) &#123;</span><br><span class="line">		logger.debug(<span class="string">&quot;User &#x27;&quot;</span> + username + <span class="string">&quot;&#x27; not found&quot;</span>);</span><br><span class="line">		<span class="keyword">if</span> (hideUserNotFoundExceptions) &#123;</span><br><span class="line">			thrownew <span class="title function_">BadCredentialsException</span><span class="params">(messages.getMessage(</span></span><br><span class="line"><span class="params">					<span class="string">&quot;AbstractUserDetailsAuthenticationProvider.badCredentials&quot;</span>,</span></span><br><span class="line"><span class="params">					<span class="string">&quot;Bad credentials&quot;</span>)</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="keyword">throw</span> notFound;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä»è¿™æ®µä»£ç ä¸­ï¼Œæˆ‘ä»¬çœ‹å‡ºï¼Œåœ¨æŸ¥æ‰¾ç”¨æˆ·æ—¶ï¼Œå¦‚æœæŠ›å‡ºäº† UsernameNotFoundExceptionï¼Œè¿™ä¸ªå¼‚å¸¸ä¼šè¢«æ•è·ï¼Œæ•è·ä¹‹åï¼Œå¦‚æœ hideUserNotFoundExceptions å±æ€§çš„å€¼ä¸º trueï¼Œå°±æŠ›å‡ºä¸€ä¸ª BadCredentialsExceptionã€‚ç›¸å½“äºå°† UsernameNotFoundException å¼‚å¸¸éšè—äº†ï¼Œè€Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒhideUserNotFoundExceptions çš„å€¼å°±ä¸º trueã€‚</p>
<p>çœ‹åˆ°è¿™é‡Œå¤§å®¶å°±æ˜ç™½äº†ä¸ºä»€ä¹ˆæ— è®ºç”¨æˆ·è¿˜æ˜¯å¯†ç å†™é”™ï¼Œä½ æ”¶åˆ°çš„éƒ½æ˜¯ BadCredentialsException å¼‚å¸¸ã€‚</p>
<p>ä¸€èˆ¬æ¥è¯´è¿™ä¸ªé…ç½®æ˜¯ä¸éœ€è¦ä¿®æ”¹çš„ï¼Œå¦‚æœä½ ä¸€å®šè¦åŒºåˆ«å‡ºæ¥ UsernameNotFoundException å’Œ BadCredentialsExceptionï¼Œæˆ‘è¿™é‡Œç»™å¤§å®¶æä¾›ä¸‰ç§æ€è·¯ï¼š</p>
<ol>
<li>è‡ªå·±å®šä¹‰ DaoAuthenticationProvider ä»£æ›¿ç³»ç»Ÿé»˜è®¤çš„ï¼Œåœ¨å®šä¹‰æ—¶å°† hideUserNotFoundExceptions å±æ€§è®¾ç½®ä¸º falseã€‚</li>
<li>å½“ç”¨æˆ·åæŸ¥æ‰¾å¤±è´¥æ—¶ï¼Œä¸æŠ›å‡º UsernameNotFoundException å¼‚å¸¸ï¼Œè€Œæ˜¯æŠ›å‡ºä¸€ä¸ªè‡ªå®šä¹‰å¼‚å¸¸ï¼Œè¿™æ ·è‡ªå®šä¹‰å¼‚å¸¸å°±ä¸ä¼šè¢«éšè—ï¼Œè¿›è€Œåœ¨ç™»å½•å¤±è´¥çš„å›è°ƒä¸­æ ¹æ®è‡ªå®šä¹‰å¼‚å¸¸ä¿¡æ¯ç»™å‰ç«¯ç”¨æˆ·ä¸€ä¸ªæç¤ºã€‚</li>
<li>å½“ç”¨æˆ·åæŸ¥æ‰¾å¤±è´¥æ—¶ï¼Œç›´æ¥æŠ›å‡º BadCredentialsExceptionï¼Œä½†æ˜¯å¼‚å¸¸ä¿¡æ¯ä¸º â€œç”¨æˆ·åä¸å­˜åœ¨â€ã€‚</li>
</ol>
<p>é™¤éæƒ…å†µç‰¹æ®Šï¼Œä¸€èˆ¬ä¸ç”¨ä¿®æ”¹è¿™ä¸€å—çš„é»˜è®¤è¡Œä¸ºã€‚</p>
<p>å®˜æ–¹è¿™æ ·åšçš„å¥½å¤„æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿå¾ˆæ˜æ˜¾å¯ä»¥å¼ºè¿«å¼€å‘è€…ç»™ä¸€ä¸ªæ¨¡ç³Šçš„å¼‚å¸¸æç¤ºï¼Œè¿™æ ·å³ä½¿æ˜¯ä¸æ‡‚è¡Œçš„æ–°æ‰‹ï¼Œä¹Ÿä¸ä¼šå°†ç³»ç»Ÿç½®äºå±é™©ä¹‹ä¸­ã€‚</p>
<p>å¥½äº†ï¼Œè¿™æ ·é…ç½®å®Œæˆåï¼Œæ— è®ºæ˜¯ç™»å½•æˆåŠŸè¿˜æ˜¯å¤±è´¥ï¼Œåç«¯éƒ½å°†åªè¿”å› JSON ç»™å‰ç«¯äº†ã€‚</p>
<h4 id="æœªè®¤è¯å¤„ç†æ–¹æ¡ˆ"><a href="#æœªè®¤è¯å¤„ç†æ–¹æ¡ˆ" class="headerlink" title="æœªè®¤è¯å¤„ç†æ–¹æ¡ˆ"></a>æœªè®¤è¯å¤„ç†æ–¹æ¡ˆ</h4><p>é‚£æœªè®¤è¯åˆæ€ä¹ˆåŠå‘¢ï¼Ÿ</p>
<p>æœ‰äººè¯´ï¼Œé‚£è¿˜ä¸ç®€å•ï¼Œæ²¡æœ‰è®¤è¯å°±è®¿é—®æ•°æ®ï¼Œç›´æ¥é‡å®šå‘åˆ°ç™»å½•é¡µé¢å°±è¡Œäº†ï¼Œè¿™æ²¡é”™ï¼Œç³»ç»Ÿé»˜è®¤çš„è¡Œä¸ºä¹Ÿæ˜¯è¿™æ ·ã€‚</p>
<p>ä½†æ˜¯åœ¨å‰åç«¯åˆ†ç¦»ä¸­ï¼Œè¿™ä¸ªé€»è¾‘æ˜æ˜¾æ˜¯æœ‰é—®é¢˜çš„ï¼Œå¦‚æœç”¨æˆ·æ²¡æœ‰ç™»å½•å°±è®¿é—®ä¸€ä¸ªéœ€è¦è®¤è¯åæ‰èƒ½è®¿é—®çš„é¡µé¢ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬ä¸åº”è¯¥è®©ç”¨æˆ·é‡å®šå‘åˆ°ç™»å½•é¡µé¢ï¼Œè€Œæ˜¯ç»™ç”¨æˆ·ä¸€ä¸ªå°šæœªç™»å½•çš„æç¤ºï¼Œå‰ç«¯æ”¶åˆ°æç¤ºä¹‹åï¼Œå†è‡ªè¡Œå†³å®šé¡µé¢è·³è½¬ã€‚</p>
<p>è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå°±æ¶‰åŠåˆ° Spring Security ä¸­çš„ä¸€ä¸ªæ¥å£ <code>AuthenticationEntryPoint</code> ï¼Œè¯¥æ¥å£æœ‰ä¸€ä¸ªå®ç°ç±»ï¼š<code>LoginUrlAuthenticationEntryPoint</code> ï¼Œè¯¥ç±»ä¸­æœ‰ä¸€ä¸ªæ–¹æ³• <code>commence</code>ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Performs the redirect (or forward) to the login form URL.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">commence</span><span class="params">(HttpServletRequest request, HttpServletResponse response,</span></span><br><span class="line"><span class="params">		AuthenticationException authException)</span> &#123;</span><br><span class="line">	<span class="type">String</span> <span class="variable">redirectUrl</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">	<span class="keyword">if</span> (useForward) &#123;</span><br><span class="line">		<span class="keyword">if</span> (forceHttps &amp;&amp; <span class="string">&quot;http&quot;</span>.equals(request.getScheme())) &#123;</span><br><span class="line">			redirectUrl = buildHttpsRedirectUrlForRequest(request);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (redirectUrl == <span class="literal">null</span>) &#123;</span><br><span class="line">			<span class="type">String</span> <span class="variable">loginForm</span> <span class="operator">=</span> determineUrlToUseForThisRequest(request, response,</span><br><span class="line">					authException);</span><br><span class="line">			<span class="keyword">if</span> (logger.isDebugEnabled()) &#123;</span><br><span class="line">				logger.debug(<span class="string">&quot;Server side forward to: &quot;</span> + loginForm);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="type">RequestDispatcher</span> <span class="variable">dispatcher</span> <span class="operator">=</span> request.getRequestDispatcher(loginForm);</span><br><span class="line">			dispatcher.forward(request, response);</span><br><span class="line">			<span class="keyword">return</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span> &#123;</span><br><span class="line">		redirectUrl = buildRedirectUrlToLoginPage(request, response, authException);</span><br><span class="line">	&#125;</span><br><span class="line">	redirectStrategy.sendRedirect(request, response, redirectUrl);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é¦–å…ˆæˆ‘ä»¬ä»è¿™ä¸ªæ–¹æ³•çš„æ³¨é‡Šä¸­å°±å¯ä»¥çœ‹å‡ºï¼Œè¿™ä¸ªæ–¹æ³•æ˜¯ç”¨æ¥å†³å®šåˆ°åº•æ˜¯è¦é‡å®šå‘è¿˜æ˜¯è¦ forwardï¼Œé€šè¿‡ Debug è¿½è¸ªï¼Œæˆ‘ä»¬å‘ç°é»˜è®¤æƒ…å†µä¸‹ useForward çš„å€¼ä¸º falseï¼Œæ‰€ä»¥è¯·æ±‚èµ°è¿›äº†é‡å®šå‘ã€‚</p>
<p>é‚£ä¹ˆæˆ‘ä»¬è§£å†³é—®é¢˜çš„æ€è·¯å¾ˆç®€å•ï¼Œç›´æ¥é‡å†™è¿™ä¸ªæ–¹æ³•ï¼Œåœ¨æ–¹æ³•ä¸­è¿”å› JSON å³å¯ï¼Œä¸å†åšé‡å®šå‘æ“ä½œï¼Œå…·ä½“é…ç½®å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">.csrf().disable().exceptionHandling()</span><br><span class="line">.authenticationEntryPoint((req, resp, authException) -&gt; &#123;</span><br><span class="line">            resp.setContentType(<span class="string">&quot;application/json;charset=utf-8&quot;</span>);</span><br><span class="line">            <span class="type">PrintWriter</span> <span class="variable">out</span> <span class="operator">=</span> resp.getWriter();</span><br><span class="line">            out.write(<span class="string">&quot;å°šæœªç™»å½•ï¼Œè¯·å…ˆç™»å½•&quot;</span>);</span><br><span class="line">            out.flush();</span><br><span class="line">            out.close();</span><br><span class="line">        &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>åœ¨ Spring Security çš„é…ç½®ä¸­åŠ ä¸Šè‡ªå®šä¹‰çš„ <code>AuthenticationEntryPoint</code> å¤„ç†æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¸­ç›´æ¥è¿”å›ç›¸åº”çš„ JSON æç¤ºå³å¯ã€‚è¿™æ ·ï¼Œå¦‚æœç”¨æˆ·å†å»ç›´æ¥è®¿é—®ä¸€ä¸ªéœ€è¦è®¤è¯ä¹‹åæ‰å¯ä»¥è®¿é—®çš„è¯·æ±‚ï¼Œå°±ä¸ä¼šå‘ç”Ÿé‡å®šå‘æ“ä½œäº†ï¼ŒæœåŠ¡ç«¯ä¼šç›´æ¥ç»™æµè§ˆå™¨ä¸€ä¸ª JSON æç¤ºï¼Œæµè§ˆå™¨æ”¶åˆ° JSON ä¹‹åï¼Œè¯¥å¹²å˜›å¹²å˜›ã€‚</p>
<h4 id="æ³¨é”€ç™»å½•"><a href="#æ³¨é”€ç™»å½•" class="headerlink" title="æ³¨é”€ç™»å½•"></a>æ³¨é”€ç™»å½•</h4><p>æœ€åæˆ‘ä»¬å†æ¥çœ‹çœ‹æ³¨é”€ç™»å½•çš„å¤„ç†æ–¹æ¡ˆã€‚</p>
<p>æ³¨é”€ç™»å½•æˆ‘ä»¬å‰é¢è¯´è¿‡ï¼ŒæŒ‰ç…§å‰é¢çš„é…ç½®ï¼Œæ³¨é”€ç™»å½•ä¹‹åï¼Œç³»ç»Ÿè‡ªåŠ¨è·³è½¬åˆ°ç™»å½•é¡µé¢ï¼Œè¿™ä¹Ÿæ˜¯ä¸åˆé€‚çš„ï¼Œå¦‚æœæ˜¯å‰åç«¯åˆ†ç¦»é¡¹ç›®ï¼Œæ³¨é”€ç™»å½•æˆåŠŸåè¿”å› JSON å³å¯ï¼Œé…ç½®å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">.and()</span><br><span class="line">.logout()</span><br><span class="line">.logoutUrl(<span class="string">&quot;/logout&quot;</span>)</span><br><span class="line">.logoutSuccessHandler((req, resp, authentication) -&gt; &#123;</span><br><span class="line">    resp.setContentType(<span class="string">&quot;application/json;charset=utf-8&quot;</span>);</span><br><span class="line">    <span class="type">PrintWriter</span> <span class="variable">out</span> <span class="operator">=</span> resp.getWriter();</span><br><span class="line">    out.write(<span class="string">&quot;æ³¨é”€æˆåŠŸ&quot;</span>);</span><br><span class="line">    out.flush();</span><br><span class="line">    out.close();</span><br><span class="line">&#125;)</span><br><span class="line">.permitAll()</span><br><span class="line">.and()</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·ï¼Œæ³¨é”€æˆåŠŸä¹‹åï¼Œå‰ç«¯æ”¶åˆ°çš„ä¹Ÿæ˜¯ JSON äº†ï¼š</p>
<h2 id="5-å¤šä¸ª-HttpSecurity"><a href="#5-å¤šä¸ª-HttpSecurity" class="headerlink" title="5.å¤šä¸ª HttpSecurity"></a>5.å¤šä¸ª HttpSecurity</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableWebSecurity</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MultiHttpSecurityConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> PasswordEncoder <span class="title function_">passwordEncoder</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> NoOpPasswordEncoder.getInstance();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(AuthenticationManagerBuilder auth)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        auth.inMemoryAuthentication().withUser(<span class="string">&quot;admin&quot;</span>).password(passwordEncoder().encode(<span class="string">&quot;123&quot;</span>)).roles(<span class="string">&quot;admin&quot;</span>);</span><br><span class="line">        auth.inMemoryAuthentication().withUser(<span class="string">&quot;user&quot;</span>).password(passwordEncoder().encode(<span class="string">&quot;123&quot;</span>)).roles(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@EnableWebSecurity</span></span><br><span class="line">    <span class="meta">@Order(1)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">AdminSecurityConfig</span> <span class="keyword">extends</span> <span class="title class_">WebSecurityConfigurerAdapter</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">            http.antMatcher(<span class="string">&quot;/admin/**&quot;</span>)</span><br><span class="line">                    .authorizeRequests()</span><br><span class="line">                    .anyRequest().hasAnyRole(<span class="string">&quot;admin&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@EnableWebSecurity</span></span><br><span class="line">    <span class="meta">@Order(2)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">OtherSecurityConfig</span> <span class="keyword">extends</span> <span class="title class_">WebSecurityConfigurerAdapter</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">            http.authorizeRequests()</span><br><span class="line">                    .anyRequest()</span><br><span class="line">                    .authenticated()</span><br><span class="line">                    .and()</span><br><span class="line">                    .formLogin()</span><br><span class="line">                    .loginProcessingUrl(<span class="string">&quot;/doLogin&quot;</span>)</span><br><span class="line">                    .permitAll()</span><br><span class="line">                    .and()</span><br><span class="line">                    .csrf().disable();</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç”¨æˆ·å‘é€è¯·æ±‚ï¼Œä¼šå…ˆå» <code>AdminSecurityConfig</code>åŒ¹é…ï¼Œåœ¨è¿™ä¸ªç±»åªæ˜¯æ‹¦æˆª <code>/admin/**</code>çš„è¯·æ±‚ï¼Œå¦‚æœåŒ¹é…ä¸åˆ°å°±ä¼šå»<code>OtherSecurityConfig</code>ç±»ä¸­è¿›è¡Œé…ç½®ï¼Œåœ¨è¿™ä¸ªç±»ä¸­ä¼šæ‹¦æˆªæ‰€æœ‰çš„è¯·æ±‚ã€‚</p>
<h2 id="6-æ–¹æ³•çº§åˆ«çš„å®‰å…¨"><a href="#6-æ–¹æ³•çº§åˆ«çš„å®‰å…¨" class="headerlink" title="6.æ–¹æ³•çº§åˆ«çš„å®‰å…¨"></a>6.æ–¹æ³•çº§åˆ«çš„å®‰å…¨</h2><p>åœ¨é…ç½®ç±»ä¸Šæ–¹æ·»åŠ æ³¨è§£ <code>@EnableGlobalMethodSecurity(prePostEnabled = true,securedEnabled = true)</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableWebSecurity</span></span><br><span class="line"><span class="meta">@EnableGlobalMethodSecurity(prePostEnabled = true,securedEnabled = true)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SecurityConfig</span> <span class="keyword">extends</span> <span class="title class_">WebSecurityConfigurerAdapter</span> &#123;</span><br></pre></td></tr></table></figure>

<p>åˆ›å»º service æ–¹æ³•</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MethodService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PreAuthorize(&quot;hasRole(&#x27;admin&#x27;)&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">admin</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;method admin&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Secured(&quot;ROLE_user&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">user</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;method user&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PreAuthorize(&quot;hasAnyRole(&#x27;admin&#x27;,&#x27;user&#x27;)&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">hello</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;method hello&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>









</div></article></div></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="/img/avatar.png" alt="å¾æµ·Wenx"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">å¾æµ·Wenx</p><p class="is-size-6 is-block">ä¸€ä¸ªå°æ ‡é¢˜</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>ä¸ªäººé“¾æ¥[æš‚æ— ]</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">æ–‡ç« </p><a href="/archives"><p class="title">17</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">åˆ†ç±»</p><a href="/categories"><p class="title">4</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">æ ‡ç­¾</p><a href="/tags"><p class="title">5</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/wenxps" target="_blank" rel="noopener">å…³æ³¨æˆ‘</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/wenxps"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="/"><i class="fas fa-rss"></i></a></div></div></div><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">åˆ†ç±»</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/spring-boot-spring-security/"><span class="level-start"><span class="level-item">spring-boot spring-security</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/spring-boot-spring-security-OAuth2/"><span class="level-start"><span class="level-item">spring-boot spring-security OAuth2</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/spring-security/"><span class="level-start"><span class="level-item">spring-security</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/categories/springboot/"><span class="level-start"><span class="level-item">springboot</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li></ul></div></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">å½’æ¡£</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2022/11/"><span class="level-start"><span class="level-item">åä¸€æœˆ 2022</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/08/"><span class="level-start"><span class="level-item">å…«æœˆ 2022</span></span><span class="level-end"><span class="level-item tag">10</span></span></a></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">æ ‡ç­¾</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/git/"><span class="tag">git</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/spring-boot-spring-security/"><span class="tag">spring-boot spring-security</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/spring-security/"><span class="tag">spring-security</span><span class="tag">9</span></a></div><div class="control"><a class="tags has-addons" href="/tags/springboot/"><span class="tag">springboot</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/websocket/"><span class="tag">websocket</span><span class="tag">3</span></a></div></div></div></div></div><div class="column-right-shadow is-hidden-widescreen is-sticky"></div></div><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only order-3 is-sticky"><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">æœ€æ–°æ–‡ç« </h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-11-23T15:21:06.000Z">2022-11-23</time></p><p class="title"><a href="/2022/11/23/%E5%9F%BA%E4%BA%8ESpring-WebSocket%E7%BB%A7%E6%89%BFStompsockjs%E5%AE%9E%E7%8E%B0%E5%8D%95%E8%81%8A%E7%BE%A4%E8%81%8A/">åŸºäºSpring-WebSocketç»§æ‰¿Stompsockjså®ç°å•èŠç¾¤èŠ</a></p><p class="categories"><a href="/categories/springboot/">springboot</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-11-23T15:07:17.000Z">2022-11-23</time></p><p class="title"><a href="/2022/11/23/%E5%9F%BA%E4%BA%8ESpring-WebSocket%E5%AE%9E%E7%8E%B0%E5%8D%95%E8%81%8A%E7%BE%A4%E8%81%8A/">åŸºäºSpring-WebSocketå®ç°å•èŠç¾¤èŠ</a></p><p class="categories"><a href="/categories/springboot/">springboot</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-11-22T12:36:58.000Z">2022-11-22</time></p><p class="title"><a href="/2022/11/22/%E5%9F%BA%E4%BA%8ETomcat-WebSocket%E5%AE%9E%E7%8E%B0%E5%8D%95%E8%81%8A%E7%BE%A4%E8%81%8A/">åŸºäºTomcat-WebSocketå®ç°å•èŠç¾¤èŠ</a></p><p class="categories"><a href="/categories/springboot/">springboot</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-11-22T05:00:58.000Z">2022-11-22</time></p><p class="title"><a href="/2022/11/22/t2/">t2</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-11-21T15:25:42.000Z">2022-11-21</time></p><p class="title"><a href="/2022/11/21/Git%E6%A6%82%E8%BF%B0/">Gitæ¦‚è¿°</a></p></div></article></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/logo.svg" alt="ç¥ˆå†¬é›ª" height="28"></a><p class="is-size-7"><span>&copy; 2022 ç¥ˆå†¬é›ª</span>Â Â Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>Â &amp;Â <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("zh-CN");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="å›åˆ°é¡¶ç«¯" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "æ­¤ç½‘ç«™ä½¿ç”¨Cookieæ¥æ”¹å–„æ‚¨çš„ä½“éªŒã€‚",
          dismiss: "çŸ¥é“äº†ï¼",
          allow: "å…è®¸ä½¿ç”¨Cookie",
          deny: "æ‹’ç»",
          link: "äº†è§£æ›´å¤š",
          policy: "Cookieæ”¿ç­–",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="æƒ³è¦æŸ¥æ‰¾ä»€ä¹ˆ..."></div><a class="searchbox-close" href="javascript:;">Ã—</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"æƒ³è¦æŸ¥æ‰¾ä»€ä¹ˆ...","untitled":"(æ— æ ‡é¢˜)","posts":"æ–‡ç« ","pages":"é¡µé¢","categories":"åˆ†ç±»","tags":"æ ‡ç­¾"});
        });</script></body></html>